




> ###Build phyloseq object (excluding the phylogenetic tree)
> bacteria.ps <- phyloseq(otu_table(otu.table_t, taxa_are_rows = TRUE),
+                         sample_data(metadata_16S),
+                         tax_table(taxa_16Ssp))
> bacteria.ps
phyloseq-class experiment-level object
otu_table()   OTU Table:         [ 16189 taxa and 118 samples ]
sample_data() Sample Data:       [ 118 samples by 30 sample variables ]
tax_table()   Taxonomy Table:    [ 16189 taxa by 7 taxonomic ranks ]

sample_data(bacteria.ps)

#exclude uncertain samples
bacteria.ps = subset_samples(bacteria.ps, bacteria.ps@sam_data$Date.of.extraction != "Exclude")

##store the DNA sequences of our ASVs in the refseq slot
dna <- Biostrings::DNAStringSet(taxa_names(bacteria.ps))
names(dna) <- taxa_names(bacteria.ps)
bacteria.ps <- merge_phyloseq(bacteria.ps, dna)
taxa_names(bacteria.ps) <- paste0("ASV", seq(ntaxa(bacteria.ps)))
> bacteria.ps
phyloseq-class experiment-level object
otu_table()   OTU Table:         [ 16189 taxa and 118 samples ]
sample_data() Sample Data:       [ 118 samples by 30 sample variables ]
tax_table()   Taxonomy Table:    [ 16189 taxa by 7 taxonomic ranks ]
refseq()      DNAStringSet:      [ 16189 reference sequences ]
> refseq(bacteria.ps)
DNAStringSet object of length 16189:
        width seq                                                                         names               
    [1]   303 GTAGTCCACGCCGTAAACGATGGATGCTAGCCGTTG...GTCAGCTCGTGTCGTGAGATGTTGGGTTAAGTCCCG ASV1
    [2]   303 GTAGTCCACGCCCTAAACGATGGATGCTAGCCGTTA...GTCAGCTCGTGTCGTGAGATGTTGGGTTAAGTCCCG ASV2
    [3]   300 GTAGTCCACGCCGTAAACGGTGGGTACTAGGTGTGG...GTCAGCTCGTGTCGTGAGATGTTGGGTTAAGTCCCG ASV3
    [4]   299 GTAGTCCACGCTGTAAACGATGAGAGCTAGTTGTCG...GTCAGCTCGTGTCGTGAGATGTTGGGTTAAGTCCCG ASV4
    [5]   299 GTAGTCCACGCTGTAAACGATGAGTGCTAGTTGTCG...GTCAGCTCGTGTCGTGAGATGTTGGGTTAAGTCCCG ASV5
    ...   ... ...
[16185]   357 TTAGTCCACGCTGTCAACTATGAAGATTCACTATCA...GTCAGCTCGTGTCGTGAGATTTTTGGTTAAGTTCTT ASV16185
[16186]   300 GTAGTCCTAGCCCTAAACGATGATTGCTTGATGTGG...GTCAGCTCGTGTCTTGAGACGTTGGGTTAAGTCCTC ASV16186
[16187]   403 GTAGTCCATGCTGTAAACGATGAGTGTTCGTTCTTG...GTCAGCTCGTGTCGTGAGATGTTGGGTTAAGTCCCG ASV16187
[16188]   298 GTAGTCCACGCCGTAAACGATGAATGCCAGCTGTTG...GTCAGCTCGTGTCTTGAGACGTTGGGTTAAGTCCTC ASV16188
[16189]   302 GTAATCCACGCCGTAAACGATGTCGACTCGGGATGT...GTCAGCTCGTGTCGTGAGATGTTGGGTTAAGTCCCG ASV16189
> ###### TAXONOMIC FILTERING ########
> # Show available ranks in the dataset
> rank_names(bacteria.ps)
[1] "Kingdom" "Phylum"  "Class"   "Order"   "Family"  "Genus"   "Species"
> # Filter non bacteria ASV
> head(tax_table(bacteria.ps), 10)
Taxonomy Table:     [10 taxa by 7 taxonomic ranks]:
      Kingdom    Phylum             Class                 Order                 Family                
ASV1  "Bacteria" "Proteobacteria"   "Alphaproteobacteria" "Rhizobiales"         "Beijerinckiaceae"    
ASV2  "Bacteria" "Proteobacteria"   "Alphaproteobacteria" "Rhizobiales"         "Beijerinckiaceae"    
ASV3  "Bacteria" "Actinobacteriota" "Actinobacteria"      "Corynebacteriales"   "Mycobacteriaceae"    
ASV4  "Bacteria" "Proteobacteria"   "Alphaproteobacteria" "Caulobacterales"     "Caulobacteraceae"    
ASV5  "Bacteria" "Proteobacteria"   "Alphaproteobacteria" "Caulobacterales"     "Caulobacteraceae"    
ASV6  "Bacteria" "Actinobacteriota" "Thermoleophilia"     "Solirubrobacterales" "Solirubrobacteraceae"
ASV7  "Bacteria" "Actinobacteriota" "Actinobacteria"      "Frankiales"          "Acidothermaceae"     
ASV8  "Bacteria" "Actinobacteriota" "Actinobacteria"      "Pseudonocardiales"   "Pseudonocardiaceae"  
ASV9  "Bacteria" "Proteobacteria"   "Alphaproteobacteria" "Rhizobiales"         "Beijerinckiaceae"    
ASV10 "Bacteria" "Actinobacteriota" "Actinobacteria"      "Frankiales"          "Acidothermaceae"     
      Genus            Species     
ASV1  "Methylocella"   NA          
ASV2  "Methylocella"   NA          
ASV3  "Mycobacterium"  "paraterrae"
ASV4  NA               NA          
ASV5  NA               NA          
ASV6  "Conexibacter"   NA          
ASV7  "Acidothermus"   NA          
ASV8  "Pseudonocardia" NA          
ASV9  "1174-901-12"    NA          
ASV10 "Acidothermus"   NA          
> bacteria.ps.filter1 = subset_taxa(bacteria.ps, Kingdom == "Bacteria")
> bacteria.ps.filter1
phyloseq-class experiment-level object
otu_table()   OTU Table:         [ 16172 taxa and 118 samples ]
sample_data() Sample Data:       [ 118 samples by 30 sample variables ]
tax_table()   Taxonomy Table:    [ 16172 taxa by 7 taxonomic ranks ]
refseq()      DNAStringSet:      [ 16172 reference sequences ]
> ntaxa(bacteria.ps)
[1] 16189
> ntaxa(bacteria.ps)-ntaxa(bacteria.ps.filter1)
[1] 17

#### Note: By looking at the number of taxa in the OTU table before and after filtering,
# We can see that all the sequences correspond to the bacteria kingdom.


## The following ensures that features with ambiguous phylum annotation 
## are also removed. Also, chloroplast and mitocondria are removed

> bacteria.ps.filter2 <- subset_taxa(bacteria.ps.filter1, !is.na(Phylum) & !Order %in% c("Chloroplast")
+                                    & !Family %in% c("Mitochondria"))
> bacteria.ps.filter2
phyloseq-class experiment-level object
otu_table()   OTU Table:         [ 15084 taxa and 118 samples ]
sample_data() Sample Data:       [ 118 samples by 30 sample variables ]
tax_table()   Taxonomy Table:    [ 15084 taxa by 7 taxonomic ranks ]
refseq()      DNAStringSet:      [ 15084 reference sequences ]

> ## check how many sequences were filter out from our raw dataset
> ntaxa(bacteria.ps.filter2)
[1] 15084
> plastids = ntaxa(bacteria.ps.filter1)-ntaxa(bacteria.ps.filter2)
> plastids #correspond to chloroplast and mitochrondia sequences
[1] 1088

 ##create table, number of features for each phyla
> phylum = table(tax_table(bacteria.ps.filter2)[, "Phylum"], exclude = NULL)
> table(tax_table(bacteria.ps.filter2)[, "Phylum"], exclude = NULL)

            Abditibacteriota              Acidobacteriota             Actinobacteriota 
                          11                          888                         2281 
              Armatimonadota                 Bacteroidota             Bdellovibrionota 
                         197                         1872                          357 
                 Chloroflexi                Cyanobacteria             Deferribacterota 
                         666                           62                            1 
                Deinococcota                 Dependentiae             Desulfobacterota 
                          95                           27                           27 
             Elusimicrobiota            Entotheonellaeota                      FCPU426 
                          29                            1                            4 
              Fibrobacterota                   Firmicutes               Fusobacteriota 
                           4                          345                            5 
             Gemmatimonadota             Margulisbacteria                       MBNT15 
                         106                            2                            2 
           Methylomirabilota                  Myxococcota                        NB1-j 
                           1                          508                            9 
                Nitrospirota              Patescibacteria              Planctomycetota 
                           6                          417                           50 
              Proteobacteria                      RCP2-54 SAR324 clade(Marine group B) 
                        6813                           12                           35 
               Spirochaetota                  Sumerlaeota            Verrucomicrobiota 
                          15                            1                          220 
                       WPS-2 
                          15 
> ##Using the follwing script sintax list the phylum that have less than 10 OTUs in a dataframe
> #This can be use automatically in the following filters
> out.taxa = data.frame(phylum <10)
> out.taxa$phylum = row.names(phylum)
> out.taxaT = out.taxa == TRUE
> table(out.taxaT)
out.taxaT
FALSE  TRUE 
   57    11 
> out.taxa=out.taxa[out.taxaT,]
> out.taxa
                  phylum...10            phylum
Deferribacterota         TRUE  Deferribacterota
Entotheonellaeota        TRUE Entotheonellaeota
FCPU426                  TRUE           FCPU426
Fibrobacterota           TRUE    Fibrobacterota
Fusobacteriota           TRUE    Fusobacteriota
Margulisbacteria         TRUE  Margulisbacteria
MBNT15                   TRUE            MBNT15
Methylomirabilota        TRUE Methylomirabilota
NB1-j                    TRUE             NB1-j
Nitrospirota             TRUE      Nitrospirota
Sumerlaeota              TRUE       Sumerlaeota
> #### Filter out phyllum with less than 10 OTUs
> # filtering by automatically listing the phylum with less than 10 OTUs
> bacteria.ps.filter3 <- subset_taxa(bacteria.ps.filter2, !Phylum %in% out.taxa$phylum)
> table(tax_table(bacteria.ps.filter3)[,"Phylum"], exclude = NULL)

            Abditibacteriota              Acidobacteriota             Actinobacteriota 
                          11                          888                         2281 
              Armatimonadota                 Bacteroidota             Bdellovibrionota 
                         197                         1872                          357 
                 Chloroflexi                Cyanobacteria                 Deinococcota 
                         666                           62                           95 
                Dependentiae             Desulfobacterota              Elusimicrobiota 
                          27                           27                           29 
                  Firmicutes              Gemmatimonadota                  Myxococcota 
                         345                          106                          508 
             Patescibacteria              Planctomycetota               Proteobacteria 
                         417                           50                         6813 
                     RCP2-54 SAR324 clade(Marine group B)                Spirochaetota 
                          12                           35                           15 
           Verrucomicrobiota                        WPS-2 
                         220                           15 
> ## Checking the amount of taxa filter out, and the proportion compare to the previous filter
> ntaxa(bacteria.ps.filter3)
[1] 15048
> rare.otus = ntaxa(bacteria.ps.filter2)-ntaxa(bacteria.ps.filter3)
> rare.otus #correspond to rare OTUs
[1] 36
> #### DECONTAMINATION ####
> bacteria.ps.dataset = bacteria.ps.filter3
> library(devtools); packageVersion("devtools")
Loading required package: usethis

Attaching package: ‘devtools’

The following object is masked from ‘package:permute’:

    check

[1] ‘2.4.5’
> library(phyloseq); packageVersion("phyloseq")
[1] ‘1.46.0’
> library(decontam); packageVersion("decontam")
[1] ‘1.22.0’
> #REMOVING NEGATIVE CONTROLS BECAUSE NO READS THROUGH
> ## Exclude samples without any reads
> bacteria.ps.dataset.norm <- prune_samples(sample_sums(bacteria.ps.dataset) > 50, bacteria.ps.dataset)
> bacteria.ps.dataset
phyloseq-class experiment-level object
otu_table()   OTU Table:         [ 15048 taxa and 118 samples ]
sample_data() Sample Data:       [ 118 samples by 30 sample variables ]
tax_table()   Taxonomy Table:    [ 15048 taxa by 7 taxonomic ranks ]
refseq()      DNAStringSet:      [ 15048 reference sequences ]
> bacteria.ps.dataset.norm
phyloseq-class experiment-level object
otu_table()   OTU Table:         [ 15048 taxa and 118 samples ]
sample_data() Sample Data:       [ 118 samples by 30 sample variables ]
tax_table()   Taxonomy Table:    [ 15048 taxa by 7 taxonomic ranks ]
refseq()      DNAStringSet:      [ 15048 reference sequences ]
# inspect library sizes
df <- as.data.frame(sample_data(bacteria.ps.dataset.norm)) #Put sample_data into a ggplot-friendly data.frame
df$LibrarySize <- sample_sums(bacteria.ps.dataset.norm)
df <- df[order(df$LibrarySize),]
df$Index <- seq(nrow(df))
head(df)
ggplot(data=df, aes(x=Index, y=LibrarySize, color=Site)) +
  geom_point()
sample_data(bacteria.ps.dataset.norm)$isneg <- sample_data(bacteria.ps.dataset.norm)$Site == "neg"
> ## FREQUENCE AND PREVALENCE - Identification des contaminants
> # Method = "either" permet de faire les deux methodes simultanement
> set.seed(420)
> contam = isContaminant(bacteria.ps.dataset.norm, conc = "Conct_ng.ul", neg = "isneg", method = "both", threshold = c(0.5,0.5))
> #Voir allure du resultat
> head(contam, 10)
             freq prev p.freq p.prev  p contaminant
ASV1  0.026419671  110    0.5     NA NA       FALSE
ASV2  0.012054026  110    0.5     NA NA       FALSE
ASV3  0.012170559  105    0.5     NA NA       FALSE
ASV4  0.010061921  114    0.5     NA NA       FALSE
ASV5  0.009382959  109    0.5     NA NA       FALSE
ASV6  0.009868503   70    0.5     NA NA       FALSE
ASV7  0.009598594   99    0.5     NA NA       FALSE
ASV8  0.009087760  108    0.5     NA NA       FALSE
ASV9  0.007777959  109    0.5     NA NA       FALSE
ASV10 0.008108195   97    0.5     NA NA       FALSE
> #combien de contaminants
> table(contam$contaminant)

FALSE 
15048 
> #voir les contaminants
> which(contam$contaminant)
integer(0)
> ##Visualisation des contaminants
> # Ne permet pas de retirer les contaminants!
> # Frequence
> plot_frequency(bacteria.ps.dataset.norm, taxa_names(bacteria.ps.dataset.norm)[c(1:9)], conc="Conct_ng.ul") + 
+   xlab("DNA.quantity_ng.ul")
Warning message:
In scale_y_log10(limits = c(NA, ifelse(normalize || all(plot_melt$DNA_conc <=  :
  log-10 transformation introduced infinite values.
> ## Retire les contaminants (Nouvel object phyloseq)
> bacteria.ps.dataset.norm
phyloseq-class experiment-level object
otu_table()   OTU Table:         [ 15048 taxa and 118 samples ]
sample_data() Sample Data:       [ 118 samples by 30 sample variables ]
tax_table()   Taxonomy Table:    [ 15048 taxa by 7 taxonomic ranks ]
refseq()      DNAStringSet:      [ 15048 reference sequences ]
> bacteria.ps.norm.decont <- prune_taxa(!contam$contaminant, bacteria.ps.dataset.norm)
> bacteria.ps.norm.decont
phyloseq-class experiment-level object
otu_table()   OTU Table:         [ 15048 taxa and 118 samples ]
sample_data() Sample Data:       [ 118 samples by 30 sample variables ]
tax_table()   Taxonomy Table:    [ 15048 taxa by 7 taxonomic ranks ]
refseq()      DNAStringSet:      [ 15048 reference sequences ]
> # Check the numer of reads per sample
> sample_sums(bacteria.ps.norm.decont)
 16S-BLANCO1  16S-BLANCO2 16S-MEC-01-1 16S-MEC-01-2 16S-MEC-02-1 16S-MEC-02-2 16S-MEC-03-1 16S-MEC-03-2 
        3418        14992        13659        21977        15926         8485        17056        29689 
16S-MEC-04-1 16S-MEC-04-2 16S-MEC-05-1 16S-MEC-05-2 16S-MEC-06-1 16S-MEC-07-1 16S-MEC-07-2 16S-MEC-08-1 
       18327        54757        15484        14508        16902        17633         8343        19902 
16S-MEC-08-2 16S-MEC-09-1 16S-MEC-09-2 16S-MEC-10-1 16S-MEC-10-2 16S-MPS-01-1 16S-MPS-01-2 16S-MPS-02-1 
       15894        18155        17132        19170        15299        16735        19614        25004 
16S-MPS-02-2 16S-MPS-03-1 16S-MPS-03-2 16S-MPS-04-1 16S-MPS-04-2 16S-MPS-05-1 16S-MPS-05-2 16S-MPS-06-1 
       23823        10988         6752        17318        13569        47566        35807        22201 
16S-MPS-06-2 16S-MPS-07-1 16S-MPS-07-2 16S-MPS-08-2 16S-MPS-21-1 16S-MPS-21-2 16S-MPS-29-1 16S-MPS-29-2 
       15928        31176        41755        55325        36505        28399        39701        44903 
16S-MSF-07-1 16S-MSF-07-2 16S-MSF-08-1 16S-MSF-08-2 16S-MSF-09-1 16S-MSF-09-2 16S-MSF-10-1 16S-MSF-10-2 
       13610        10868        19174        14989        19907         6382        22992        20132 
16S-MSF-11-1 16S-MSF-11-2 16S-MSF-17-1 16S-MSF-17-2 16S-MSF-18-1 16S-MSF-18-2 16S-MSF-19-2 16S-MSF-21-1 
       13318        12492        16965        20041        14582        10502        20678        12083 
16S-MSF-21-2 16S-MSF-22-1 16S-MSF-22-2 16S-OEC-01-1 16S-OEC-01-2 16S-OEC-02-1 16S-OEC-02-2 16S-OEC-03-1 
        4610        28700        13359        24731        17760        24537        16680        27438 
16S-OEC-03-2 16S-OEC-04-1 16S-OEC-04-2 16S-OEC-05-1 16S-OEC-05-2 16S-OEC-06-1 16S-OEC-06-2 16S-OEC-07-1 
       20427        20460        22767        24827        21174        20942        18415        13421 
16S-OEC-07-2 16S-OEC-08-1 16S-OEC-08-2 16S-OEC-09-1 16S-OEC-09-2 16S-OEC-10-1 16S-OEC-10-2 16S-OPS-01-1 
       19200        34517        24523        21810        20848        24708        17172        22167 
16S-OPS-01-2 16S-OPS-02-1 16S-OPS-02-2 16S-OPS-03-1 16S-OPS-03-2 16S-OPS-04-1 16S-OPS-04-2 16S-OPS-05-1 
       10886        16240        49656        14101        14208          979        14161        11552 
16S-OPS-05-2 16S-OPS-06-1 16S-OPS-06-2 16S-OPS-07-1 16S-OPS-07-2 16S-OPS-08-1 16S-OPS-08-2 16S-OPS-21-1 
       29171        34022        24497        50919        51191        34355        49108        40886 
16S-OPS-29-1 16S-OPS-29-2 16S-OSF-07-1 16S-OSF-07-2 16S-OSF-08-1 16S-OSF-08-2 16S-OSF-09-1 16S-OSF-09-2 
       16707        60625        11369        19197         8000        17962         3890         3503 
16S-OSF-10-1 16S-OSF-10-2 16S-OSF-11-1 16S-OSF-11-2 16S-OSF-17-1 16S-OSF-17-2 16S-OSF-18-1 16S-OSF-18-2 
       15001        21799         9002        23551        18482        13988        16261        14298 
16S-OSF-19-1 16S-OSF-19-2 16S-OSF-21-1 16S-OSF-21-2 16S-OSF-22-1 16S-OSF-22-2 
       11006        19848        19040        11027        15221        11601 
> hist(sample_sums(bacteria.ps.norm.decont), main = "Histogram: Read Counts",
+      xlab = "Total Reads", border = "black", col = "yellow", las=1, breaks = 10)
> ##Check the number of reads per taxa
> head(taxa_sums(bacteria.ps.norm.decont),100)
  ASV1   ASV2   ASV3   ASV4   ASV5   ASV6   ASV7   ASV8   ASV9  ASV10  ASV11  ASV12  ASV13  ASV14  ASV15 
 58524  27668  26778  23806  22814  22423  21088  20439  18352  18007  14721  13639  13696  13579  12605 
 ASV16  ASV17  ASV18  ASV19  ASV20  ASV21  ASV23  ASV24  ASV25  ASV26  ASV27  ASV28  ASV29  ASV30  ASV31 
 13253  11718  11242  11279  11025   9759   9506   8498   8732   8535   8435   8361   8141   8294   8145 
 ASV32  ASV33  ASV34  ASV35  ASV36  ASV37  ASV38  ASV39  ASV40  ASV41  ASV42  ASV43  ASV44  ASV45  ASV46 
  8011   7957   8058   7766   7803   7761   7725   7627   7584   7564   7526   7576   7640   7575   7213 
 ASV47  ASV48  ASV49  ASV50  ASV51  ASV52  ASV53  ASV54  ASV55  ASV56  ASV57  ASV58  ASV59  ASV60  ASV61 
  7248   7300   7251   6978   6795   7082   6957   6652   6548   6296   6353   6193   6324   6396   6403 
 ASV62  ASV63  ASV64  ASV65  ASV66  ASV67  ASV68  ASV69  ASV70  ASV71  ASV72  ASV73  ASV74  ASV75  ASV76 
  6192   6181   6202   6163   2268   5917   5883   5803   5703   5715   5610   5677   5557   5415   5309 
 ASV77  ASV78  ASV79  ASV80  ASV81  ASV82  ASV83  ASV84  ASV85  ASV86  ASV87  ASV88  ASV89  ASV90  ASV91 
  5370   5314   5242   5212   5254   5086   5209   5032   4953   5103   2063   5057   4939   4876   4875 
 ASV92  ASV93  ASV94  ASV95  ASV96  ASV97  ASV98  ASV99 ASV100 ASV101 
  4684   4610   4774   4630   4492   4581   4658   4671   4550   4559 
## Creation dun subset de phyloseq SANS negatif
> bacteria.ps.norm.decont <- subset_samples(bacteria.ps.norm.decont, Site != "neg")
> bacteria.ps.norm.decont <- subset_samples(bacteria.ps.norm.decont, Site != "16S-MEC-01-1")
> # Distribution de frequence du nombre de lectures sans les controles negatifs
> hist(sample_sums(bacteria.ps.norm.decont), main = "Histogram: Read Counts",
+      xlab = "Total Reads", border = "black", col = "darkgreen", las=1, breaks = 10)
> saveRDS(bacteria.ps.norm.decont, "ZamiaPhyllosphere_16S_decontam_com01.rds")
> ################################################################################
> ## Prevalence: number of samples in which a taxon appears at least once.
> #
> #
> bacteria.ps.norm.decont
phyloseq-class experiment-level object
otu_table()   OTU Table:         [ 15048 taxa and 118 samples ]
sample_data() Sample Data:       [ 118 samples by 30 sample variables ]
tax_table()   Taxonomy Table:    [ 15048 taxa by 7 taxonomic ranks ]
refseq()      DNAStringSet:      [ 15048 reference sequences ]
> # Compute prevalence of each feature, store as data.frame
> prevdf.4 = apply(X = otu_table(bacteria.ps.norm.decont),
+                  MARGIN = ifelse(taxa_are_rows(bacteria.ps.norm.decont), yes = 1, no = 2),
+                  FUN = function(x){sum(x > 0)})
> ##Add taxonomy and total read counts to this data.frame
> prevdf.4 = data.frame(Prevalence = prevdf.4,
+                       TotalAbundance = taxa_sums(bacteria.ps.norm.decont),
+                       tax_table(bacteria.ps.norm.decont))
> head(prevdf.4)
     Prevalence TotalAbundance  Kingdom           Phylum               Class               Order
ASV1        110          58524 Bacteria   Proteobacteria Alphaproteobacteria         Rhizobiales
ASV2        110          27668 Bacteria   Proteobacteria Alphaproteobacteria         Rhizobiales
ASV3        105          26778 Bacteria Actinobacteriota      Actinobacteria   Corynebacteriales
ASV4        114          23806 Bacteria   Proteobacteria Alphaproteobacteria     Caulobacterales
ASV5        109          22814 Bacteria   Proteobacteria Alphaproteobacteria     Caulobacterales
ASV6         70          22423 Bacteria Actinobacteriota     Thermoleophilia Solirubrobacterales
                   Family         Genus    Species
ASV1     Beijerinckiaceae  Methylocella       <NA>
ASV2     Beijerinckiaceae  Methylocella       <NA>
ASV3     Mycobacteriaceae Mycobacterium paraterrae
ASV4     Caulobacteraceae          <NA>       <NA>
ASV5     Caulobacteraceae          <NA>       <NA>
ASV6 Solirubrobacteraceae  Conexibacter       <NA>
> plyr::ddply(prevdf.4, "Phylum", function(df1){cbind(mean(df1$Prevalence),
+                                                     sum(df1$Prevalence))})
                         Phylum         1     2
1              Abditibacteriota 1.2727273    14
2               Acidobacteriota 3.4324324  3048
3              Actinobacteriota 5.1959667 11852
4                Armatimonadota 2.9492386   581
5                  Bacteroidota 2.4791667  4641
6              Bdellovibrionota 1.3193277   471
7                   Chloroflexi 3.0105105  2005
8                 Cyanobacteria 1.5000000    93
9                  Deinococcota 3.5052632   333
10                 Dependentiae 1.0000000    27
11             Desulfobacterota 0.8518519    23
12              Elusimicrobiota 0.9310345    27
13                   Firmicutes 1.3710145   473
14              Gemmatimonadota 1.7264151   183
15                  Myxococcota 2.2322835  1134
16              Patescibacteria 1.7074341   712
17              Planctomycetota 1.0400000    52
18               Proteobacteria 3.5785997 24381
19                      RCP2-54 0.9166667    11
20 SAR324 clade(Marine group B) 1.1428571    40
21                Spirochaetota 0.8666667    13
22            Verrucomicrobiota 1.4454545   318
23                        WPS-2 1.2666667    19

> ## Subset to remaining phyla
> prevdf.4.1 = subset(prevdf.4, Phylum %in% get_taxa_unique(bacteria.ps.norm.decont, "Phylum"))
> head(prevdf.4.1)
     Prevalence TotalAbundance  Kingdom           Phylum               Class               Order
ASV1        110          58524 Bacteria   Proteobacteria Alphaproteobacteria         Rhizobiales
ASV2        110          27668 Bacteria   Proteobacteria Alphaproteobacteria         Rhizobiales
ASV3        105          26778 Bacteria Actinobacteriota      Actinobacteria   Corynebacteriales
ASV4        114          23806 Bacteria   Proteobacteria Alphaproteobacteria     Caulobacterales
ASV5        109          22814 Bacteria   Proteobacteria Alphaproteobacteria     Caulobacterales
ASV6         70          22423 Bacteria Actinobacteriota     Thermoleophilia Solirubrobacterales
                   Family         Genus    Species
ASV1     Beijerinckiaceae  Methylocella       <NA>
ASV2     Beijerinckiaceae  Methylocella       <NA>
ASV3     Mycobacteriaceae Mycobacterium paraterrae
ASV4     Caulobacteraceae          <NA>       <NA>
ASV5     Caulobacteraceae          <NA>       <NA>
ASV6 Solirubrobacteraceae  Conexibacter       <NA>
> ggplot(prevdf.4.1, aes(TotalAbundance, Prevalence / nsamples(bacteria.ps.norm.decont), color=Phylum)) +
+   # Include a guess for parameter
+   geom_hline(yintercept = 0.020, alpha = 0.5, linetype = 2) + geom_point(size = 2, alpha = 0.7) +
+   scale_x_log10() + xlab("Total Abundance") + ylab("Prevalence [Frac. Samples]") +
+   facet_wrap(~Phylum) +
+   theme_classic() +
+   theme(legend.position = "none")
Warning message:
In scale_x_log10() :
  log-10 transformation introduced infinite values.
> taxa_sums(bacteria.ps.norm.decont)
   ASV1    ASV2    ASV3    ASV4    ASV5    ASV6    ASV7    ASV8    ASV9   ASV10   ASV11   ASV12   ASV13 
  58524   27668   26778   23806   22814   22423   21088   20439   18352   18007   14721   13639   13696 
  ASV14   ASV15   ASV16   ASV17   ASV18   ASV19   ASV20   ASV21   ASV23   ASV24   ASV25   ASV26   ASV27 
  13579   12605   13253   11718   11242   11279   11025    9759    9506    8498    8732    8535    8435 
  ASV28   ASV29   ASV30   ASV31   ASV32   ASV33   ASV34   ASV35   ASV36   ASV37   ASV38   ASV39   ASV40 
   8361    8141    8294    8145    8011    7957    8058    7766    7803    7761    7725    7627    7584 
  ASV41   ASV42   ASV43   ASV44   ASV45   ASV46   ASV47   ASV48   ASV49   ASV50   ASV51   ASV52   ASV53 
   7564    7526    7576    7640    7575    7213    7248    7300    7251    6978    6795    7082    6957 
  ASV54   ASV55   ASV56   ASV57   ASV58   ASV59   ASV60   ASV61   ASV62   ASV63   ASV64   ASV65   ASV66 
   6652    6548    6296    6353    6193    6324    6396    6403    6192    6181    6202    6163    2268 
  ASV67   ASV68   ASV69   ASV70   ASV71   ASV72   ASV73   ASV74   ASV75   ASV76   ASV77   ASV78   ASV79 
   5917    5883    5803    5703    5715    5610    5677    5557    5415    5309    5370    5314    5242 
  ASV80   ASV81   ASV82   ASV83   ASV84   ASV85   ASV86   ASV87   ASV88   ASV89   ASV90   ASV91   ASV92 
   5212    5254    5086    5209    5032    4953    5103    2063    5057    4939    4876    4875    4684 
  ASV93   ASV94   ASV95   ASV96   ASV97   ASV98   ASV99  ASV100  ASV101  ASV102  ASV103  ASV105  ASV106 
   4610    4774    4630    4492    4581    4658    4671    4550    4559    4649    4433    4519    4479 
 ASV107  ASV108  ASV109  ASV110  ASV111  ASV112  ASV113  ASV114  ASV115  ASV116  ASV117  ASV118  ASV119 
   4390    4359    4255    3824    4141    4151    4116    4084    4008    4051    3994    3936    3888 
 ASV120  ASV121  ASV122  ASV123  ASV124  ASV125  ASV126  ASV127  ASV128  ASV129  ASV130  ASV131  ASV132 
   3902    3845    3631    3714    3715    3172    3704    3620    3609    3578    3504    3498    3367 
 ASV133  ASV134  ASV135  ASV136  ASV137  ASV138  ASV139  ASV140  ASV141  ASV142  ASV143  ASV144  ASV145 
   3090    3457    3501    3386    3310    3444    3294    3441    3250    3377    3416    3307    3312 
 ASV146  ASV147  ASV148  ASV149  ASV150  ASV151  ASV152  ASV153  ASV154  ASV155  ASV156  ASV157  ASV158 
   3265    3276    3292    3255    3290    3286    3228    3213    3162    3206    3104    3162    3144 
 ASV159  ASV160  ASV161  ASV162  ASV163  ASV164  ASV165  ASV166  ASV167  ASV168  ASV169  ASV170  ASV171 
   3178    2905    3076    3118    2948    3092    3057    2991    3056    2895    2953    3012    2855 
 ASV172  ASV173  ASV174  ASV175  ASV176  ASV177  ASV178  ASV179  ASV180  ASV181  ASV182  ASV183  ASV184 
   2345    2926    2924    2906    2683    2820    2837    2830    2843    2895    2883    2481    2871 
 ASV185  ASV186  ASV187  ASV188  ASV189  ASV190  ASV191  ASV192  ASV193  ASV194  ASV195  ASV196  ASV197 
   2844    2422    2798    2796    2786    2732    2776    2766    2736    2719    2686    2674    2691 
 ASV198  ASV199  ASV200  ASV201  ASV202  ASV203  ASV204  ASV205  ASV206  ASV207  ASV208  ASV209  ASV210 
   2677    2665    2660    2657    2657    2579    2620    2593    2598    2574    2568    2332    2411 
 ASV211  ASV212  ASV213  ASV214  ASV215  ASV216  ASV217  ASV218  ASV219  ASV220  ASV221  ASV222  ASV223 
   2506    2358     286    2483    2449    2435    2466    2317    2452    2395    2328    2411    2348 
 ASV224  ASV225  ASV226  ASV227  ASV228  ASV229  ASV230  ASV231  ASV232  ASV233  ASV234  ASV235  ASV236 
   1371    2350    2257       0    2344    2355    2379    2332    2317    2356    2256    2302    2273 
 ASV237  ASV238  ASV239  ASV240  ASV241  ASV242  ASV243  ASV244  ASV245  ASV246  ASV247  ASV248  ASV249 
   2324    2140    2254    2257    2258    2090    1986    2198    2065    2023    2166    2055    2145 
 ASV250  ASV251  ASV252  ASV253  ASV254  ASV255  ASV256  ASV257  ASV258  ASV259  ASV260  ASV261  ASV262 
   2126    2130    2051    2067    2100    2099    2096    2030    2065    1910    2056    2050    2047 
 ASV263  ASV264  ASV265  ASV266  ASV267  ASV268  ASV269  ASV270  ASV271  ASV272  ASV273  ASV274  ASV275 
   2046    2035    2035    1965    2003    1969    1937    1974    1906    1958    1930    1908    1900 
 ASV276  ASV277  ASV278  ASV279  ASV280  ASV281  ASV282  ASV283  ASV284  ASV285  ASV286  ASV287  ASV288 
   1930    1926    1897    1880    1853    1891    1871    1869    1828    1860    1771    1792    1850 
 ASV289  ASV290  ASV291  ASV292  ASV293  ASV294  ASV295  ASV296  ASV297  ASV298  ASV299  ASV300  ASV301 
   1834    1827    1795    1708    1793    1673    1787     284    1775    1675    1773    1634    1751 
 ASV302  ASV303  ASV304  ASV305  ASV306  ASV307  ASV308  ASV309  ASV310  ASV311  ASV312  ASV313  ASV314 
   1734    1720    1717    1714    1654    1613    1666    1518    1664    1656    1649    1557    1637 
 ASV315  ASV316  ASV317  ASV318  ASV319  ASV320  ASV321  ASV322  ASV323  ASV324  ASV325  ASV326  ASV327 
   1635    1597    1634    1630    1620    1588    1613    1605    1570    1599    1568    1586    1554 
 ASV328  ASV329  ASV330  ASV331  ASV332  ASV333  ASV334  ASV335  ASV336  ASV337  ASV338  ASV339  ASV340 
   1580    1470    1523    1521    1543    1535    1519    1439    1485    1488    1509    1492    1470 
 ASV341  ASV342  ASV343  ASV344  ASV345  ASV346  ASV347  ASV348  ASV349  ASV350  ASV351  ASV352  ASV353 
   1429    1450    1482    1158    1464    1327    1417    1438    1458    1447    1383    1424    1412 
 ASV354  ASV355  ASV356  ASV357  ASV358  ASV359  ASV360  ASV361  ASV362  ASV363  ASV364  ASV365  ASV366 
   1416    1415    1412    1410    1407    1407    1380    1398    1353    1396    1395    1372    1285 
 ASV367  ASV368  ASV369  ASV370  ASV371  ASV372  ASV373  ASV374  ASV375  ASV376  ASV377  ASV378  ASV379 
   1370    1368    1362    1324    1274    1356    1271    1330    1353    1267    1226    1350    1347 
 ASV380  ASV381  ASV382  ASV383  ASV384  ASV385  ASV386  ASV387  ASV388  ASV389  ASV390  ASV391  ASV392 
    387    1340    1295    1335    1332    1304    1296    1316    1305    1304    1298    1216    1277 
 ASV393  ASV394  ASV395  ASV396  ASV398  ASV399  ASV400  ASV401  ASV402  ASV403  ASV404  ASV405  ASV406 
   1260    1233    1257    1248    1243    1243    1242    1237    1229    1215    1228    1206    1184 
 ASV408  ASV409  ASV410  ASV411  ASV412  ASV413  ASV414  ASV415  ASV416  ASV417  ASV418  ASV419  ASV420 
   1215    1215    1210    1206    1143    1161    1188     776    1110    1093    1177    1172    1171 
 ASV421  ASV422  ASV423  ASV424  ASV425  ASV426  ASV427  ASV428  ASV429  ASV431  ASV432  ASV433  ASV434 
   1169    1152    1168    1167    1084    1095    1159    1159    1157    1154    1151    1150    1142 
 ASV435  ASV436  ASV437  ASV438  ASV439  ASV440  ASV441  ASV442  ASV443  ASV444  ASV445  ASV446  ASV447 
   1070    1128    1138    1138    1137    1016    1107    1133    1133    1132    1111    1128     979 
 ASV448  ASV449  ASV450  ASV451  ASV452  ASV453  ASV455  ASV456  ASV457  ASV458  ASV459  ASV460  ASV461 
   1120    1118    1073    1039    1109    1107    1106    1050    1091    1089    1053    1082    1074 
 ASV462  ASV463  ASV464  ASV465  ASV466  ASV467  ASV468  ASV469  ASV470  ASV471  ASV472  ASV473  ASV474 
   1074    1071    1066    1046    1060    1057    1052    1040    1036    1029    1004    1025     953 
 ASV475  ASV476  ASV477  ASV478  ASV479  ASV480  ASV481  ASV482  ASV483  ASV484  ASV485  ASV486  ASV487 
   1017    1016     936    1012    1012    1011    1004     956    1002     999     996     994     992 
 ASV488  ASV489  ASV490  ASV491  ASV492  ASV493  ASV494  ASV495  ASV496  ASV497  ASV498  ASV499  ASV500 
    992     972     989     835     979     978     975     471     886     914     956     956     955 
 ASV501  ASV502  ASV503  ASV504  ASV505  ASV506  ASV507  ASV508  ASV509  ASV510  ASV511  ASV512  ASV513 
    955     955     953     772     944     941     844     939     937     897     933     933     930 
 ASV514  ASV515  ASV516  ASV517  ASV518  ASV519  ASV520  ASV521  ASV522  ASV524  ASV525  ASV526  ASV527 
    929     873     929     723     909     925     924     874     923     896     915     876     890 
 ASV528  ASV529  ASV530  ASV531  ASV532  ASV533  ASV534  ASV535  ASV536  ASV537  ASV538  ASV539  ASV540 
    910     907     906     874     898     895     895     894     893     891     890     473     886 
 ASV541  ASV542  ASV543  ASV544  ASV545  ASV546  ASV547  ASV548  ASV549  ASV550  ASV551  ASV552  ASV553 
    830     885     884     884     884     741     859     880     879     749      87     869     821 
 ASV554  ASV555  ASV556  ASV557  ASV558  ASV559  ASV560  ASV561  ASV562  ASV563  ASV564  ASV565  ASV566 
    864     864     707     861     824     852     852     819     852       3     846     846     644 
 ASV567  ASV568  ASV569  ASV570  ASV571  ASV572  ASV573  ASV574  ASV575  ASV576  ASV577  ASV578  ASV579 
    833     832     830     829     727     829     814     825     823     823     626     799     818 
 ASV580  ASV581  ASV582  ASV583  ASV584  ASV585  ASV586  ASV587  ASV588  ASV589  ASV590  ASV591  ASV592 
    818     818     804     817     802      94     814     812     811     810     778     810     759 
 ASV593  ASV594  ASV595  ASV596  ASV597  ASV598  ASV599  ASV600  ASV601  ASV602  ASV603  ASV604  ASV605 
    782     803     801     801     783     798     794     794     774     790     788     782     780 
 ASV606  ASV607  ASV608  ASV609  ASV610  ASV611  ASV612  ASV613  ASV614  ASV615  ASV616  ASV617  ASV618 
      0     778     777     777     776     742     772     769     768     756     740     747     757 
 ASV619  ASV620  ASV621  ASV622  ASV623  ASV624  ASV625  ASV626  ASV627  ASV628  ASV629  ASV630  ASV631 
      0     701     265     753     752     751     751     750     747     740     702     736     735 
 ASV632  ASV634  ASV635  ASV636  ASV637  ASV638  ASV639  ASV640  ASV641  ASV642  ASV643  ASV644  ASV645 
    706     733     733     728     668     726     724     723     722     721     721     719     718 
 ASV646  ASV647  ASV648  ASV649  ASV650  ASV651  ASV652  ASV653  ASV654  ASV655  ASV656  ASV657  ASV658 
    718     718     716     715     714     713     713     692     712     712     705     710     709 
 ASV659  ASV660  ASV661  ASV662  ASV663  ASV664  ASV665  ASV666  ASV667  ASV668  ASV669  ASV670  ASV671 
    708     704     703     702     701     699     697     696     584     694     689     688     687 
 ASV672  ASV673  ASV674  ASV675  ASV676  ASV677  ASV678  ASV679  ASV680  ASV681  ASV682  ASV683  ASV684 
    685     684     684     681     681     679     676     629     675     675     674     673     657 
 ASV685  ASV686  ASV687  ASV688  ASV689  ASV690  ASV691  ASV692  ASV693  ASV694  ASV695  ASV696  ASV697 
    672     672     672     671     668     665     589       0     653     663     662     662     662 
 ASV698  ASV699  ASV700  ASV701  ASV702  ASV703  ASV704  ASV705  ASV706  ASV707  ASV708  ASV709  ASV710 
    660       0     657     651     631     649     648     648     634     646     530     645     643 
 ASV712  ASV713  ASV714  ASV715  ASV716  ASV717  ASV718  ASV719  ASV720  ASV721  ASV722  ASV723  ASV724 
    642     641     545     639     522     630     615     629     629     628     627     575     626 
 ASV725  ASV726  ASV727  ASV728  ASV729  ASV730  ASV731  ASV732  ASV733  ASV734  ASV735  ASV736  ASV737 
    626     626     585     626     625     624     624     622     504     588     587     618     618 
 ASV738  ASV739  ASV740  ASV741  ASV742  ASV743  ASV744  ASV745  ASV746  ASV747  ASV748  ASV749  ASV750 
    618     616     611     525     607     558     593     606     606     604     601     600     597 
 ASV751  ASV752  ASV753  ASV754  ASV755  ASV756  ASV757  ASV758  ASV759  ASV760  ASV761  ASV762  ASV763 
    597     595     587     565     506     585     585     585     563     582     582     581     581 
 ASV764  ASV765  ASV766  ASV767  ASV768  ASV769  ASV770  ASV771  ASV772  ASV773  ASV774  ASV775  ASV776 
    580     579     577     577     509     576     565     572     571     571     571     570     570 
 ASV777  ASV778  ASV779  ASV780  ASV781  ASV782  ASV783  ASV784  ASV785  ASV786  ASV787  ASV788  ASV789 
    570     569     569     568     568     566     566     566     566     562     561     542     558 
 ASV790  ASV791  ASV792  ASV793  ASV794  ASV795  ASV796  ASV797  ASV798  ASV799  ASV800  ASV801  ASV802 
    556     555     537     481     552     550     514     549     548     547     546     545     543 
 ASV803  ASV804  ASV805  ASV806  ASV807  ASV808  ASV809  ASV810  ASV811  ASV812  ASV813  ASV814  ASV815 
    542     284     537     537     537     513     534     531     530     529     529     491     527 
 ASV816  ASV817  ASV818  ASV819  ASV820  ASV821  ASV822  ASV823  ASV824  ASV825  ASV826  ASV827  ASV828 
    524     524     524     520     493     518     518     517     517     516     516     515      27 
 ASV829  ASV830  ASV831  ASV832  ASV833  ASV834  ASV835  ASV836  ASV837  ASV838  ASV839  ASV840  ASV841 
    514     514     514     514     514     514     513     504     511     510     509     508     508 
 ASV842  ASV843  ASV844  ASV845  ASV846  ASV847  ASV848  ASV849  ASV850  ASV851  ASV852  ASV853  ASV854 
    506     506     505     505     503     503     502     502     502     481     501     500     500 
 ASV855  ASV856  ASV857  ASV858  ASV859  ASV860  ASV861  ASV862  ASV863  ASV864  ASV865  ASV866  ASV867 
    500       0     191     440     479     498     497     497     496     495     446     494     494 
 ASV868  ASV869  ASV870  ASV871  ASV872  ASV873  ASV874  ASV875  ASV876  ASV877  ASV878  ASV879  ASV880 
    493     492     491     490     490     489     489     458     488     485     485     485     484 
 ASV881  ASV882  ASV883  ASV884  ASV885  ASV886  ASV887  ASV888  ASV889  ASV890  ASV891  ASV892  ASV893 
    418     480     480     479     478     478     477     476     475     393     474     381     423 
 ASV894  ASV895  ASV896  ASV897  ASV898  ASV899  ASV900  ASV901  ASV902  ASV903  ASV904  ASV905  ASV906 
    472     472     472     469     469     426     467     467     466     466     466     466     465 
 ASV907  ASV908  ASV909  ASV910  ASV911  ASV912  ASV913  ASV914  ASV915  ASV916  ASV917  ASV918  ASV919 
    465     443     465     465     395     464     464     334     464     463     463     463     362 
 ASV920  ASV921  ASV922  ASV923  ASV924  ASV925  ASV926  ASV927  ASV928  ASV929  ASV930  ASV931  ASV932 
    461     460     458     457     289     432     454     396     454     453     452     451     450 
 ASV933  ASV934  ASV935  ASV936  ASV937  ASV938  ASV939  ASV940  ASV941  ASV942  ASV943  ASV944  ASV945 
    430     450     434     448     447     446     446     346     445     445     444     443     443 
 ASV946  ASV947  ASV948  ASV949  ASV950  ASV951  ASV952  ASV953  ASV954  ASV955  ASV956  ASV957  ASV958 
    442     442     440     440     408     438     437     379     437     429     436     435     434 
 ASV959  ASV960  ASV961  ASV962  ASV963  ASV964  ASV965  ASV966  ASV967  ASV968  ASV969  ASV970  ASV971 
    433     431     430     227     430     429     428     353     426     425     425     425     425 
 ASV972  ASV973  ASV974  ASV975  ASV976  ASV977  ASV978  ASV979  ASV980  ASV981  ASV982  ASV983  ASV984 
    424     424     384     422     422     337     421     421     421     419     417     398     415 
 ASV985  ASV986  ASV987  ASV988  ASV989  ASV990  ASV991  ASV992  ASV993  ASV994  ASV995  ASV996  ASV997 
    414     402     414     352     414     412     411     373     329     410     410       0      14 
 ASV998  ASV999 ASV1000 ASV1001 ASV1002 ASV1003 ASV1004 ASV1005 ASV1006 ASV1008 ASV1009 ASV1011 
    179     405     405     404     402     401     400     400     400     398     398     357 
 [ reached getOption("max.print") -- omitted 14048 entries ]
> ## filter out phylum with prevalence = 1.00000
> #Define prevalence threshold to remove OTU present in only one sample
> prevalenceThreshold = 0.018 * nsamples(bacteria.ps.norm.decont)
> prevalenceThreshold
[1] 2.124
> #Execute prevalence filter, using prune_taxa() function
> keepTaxa = rownames(prevdf.4.1)[(prevdf.4.1$Prevalence >= prevalenceThreshold)]
> bacteria.ps.dataset.prev = prune_taxa(keepTaxa, bacteria.ps.norm.decont)
> bacteria.ps.dataset.prev
phyloseq-class experiment-level object
otu_table()   OTU Table:         [ 3099 taxa and 118 samples ]
sample_data() Sample Data:       [ 118 samples by 30 sample variables ]
tax_table()   Taxonomy Table:    [ 3099 taxa by 7 taxonomic ranks ]
refseq()      DNAStringSet:      [ 3099 reference sequences ]
> table(tax_table(bacteria.ps.dataset.prev)[, "Phylum"], exclude = NULL)

            Abditibacteriota              Acidobacteriota             Actinobacteriota 
                           1                          220                          595 
              Armatimonadota                 Bacteroidota             Bdellovibrionota 
                          32                          321                           29 
                 Chloroflexi                Cyanobacteria                 Deinococcota 
                         174                            6                           25 
                  Firmicutes              Gemmatimonadota                  Myxococcota 
                          18                           14                           73 
             Patescibacteria              Planctomycetota               Proteobacteria 
                          57                            1                         1515 
SAR324 clade(Marine group B)            Verrucomicrobiota                        WPS-2 
                           2                           15                            1 
> table(tax_table(bacteria.ps.dataset.prev)[, "Order"], exclude = NULL)

                         0319-6G20                  Abditibacteriales                    Acetobacterales 
                                14                                  1                                282 
                  Acidobacteriales                    Armatimonadales                     Azospirillales 
                               148                                 12                                  3 
                        Bacillales                  Bdellovibrionales                   Blastocatellales 
                                 4                                  6                                  3 
                           Blfdi19                     Bryobacterales                    Burkholderiales 
                                 1                                 18                                113 
                             C0119                    Caedibacterales                    Caulobacterales 
                                29                                 15                                 71 
                             CCD24                    Chitinophagales                       Chlamydiales 
                                 1                                 71                                  6 
                    Chloroflexales                 Chthoniobacterales                  Corynebacteriales 
                               111                                  3                                 30 
                  Cyanobacteriales                       Cytophagales                   Defluviicoccales 
                                 1                                186                                  2 
                     Deinococcales                 Diplorickettsiales                         Elsterales 
                                25                                  2                                 15 
                  Enterobacterales                   Fimbriimonadales                   Flavobacteriales 
                                21                                 20                                 13 
                        Frankiales                         Gaiellales Gammaproteobacteria Incertae Sedis 
                               158                                  9                                 18 
                  Gemmatimonadales                       Haliangiales                       Holophagales 
                                13                                 22                                  1 
                         IMCC26256                       JG36-TzT-191                      Kallotenuales 
                                11                                  5                                  4 
                   Kapabacteriales                        KF-JG30-C25                     Kineosporiales 
                                 1                                  1                                 26 
                 Ktedonobacterales                    Lactobacillales                   Longimicrobiales 
                                 7                                  5                                  1 
                   Micavibrionales                      Micrococcales                  Micromonosporales 
                                10                                 45                                 33 
                     Micropepsales                     Microtrichales                            mle1-27 
                                21                                 15                                  3 
                      Myxococcales                      Oligoflexales                    Paenibacillales 
                                23                                  8                                  4 
                     Paludibaculum                Paracaedibacterales                     Pedosphaerales 
                                 2                                  6                                  6 
                      Polyangiales                Propionibacteriales                    Pseudomonadales 
                                24                                 81                                 17 
                 Pseudonocardiales                              R7C24                        RBG-13-54-9 
                                97                                  5                                  1 
                     Reyranellales                        Rhizobiales                    Rhodobacterales 
                                 5                                572                                  2 
                  Rhodospirillales                      Rickettsiales                  Saccharimonadales 
                                 8                                 47                                 55 
                  Salinisphaerales                   Silvanigrellales                     Solibacterales 
                                 8                                  1                                 27 
               Solirubrobacterales                 Sphingobacteriales                   Sphingomonadales 
                                65                                 50                                195 
                  Staphylococcales                   Streptomycetales                Streptosporangiales 
                                 5                                  8                                  6 
                        Subgroup 2              Thermoanaerobaculales                  Thermomicrobiales 
                                16                                  1                                  4 
                      Tistrellales                              WD260                    Xanthomonadales 
                                 3                                 11                                 22 
                              <NA> 
                                78 
> rank_names(bacteria.ps.dataset.prev)
[1] "Kingdom" "Phylum"  "Class"   "Order"   "Family"  "Genus"   "Species"
> table(tax_table(bacteria.ps.dataset.prev)[, "Family"], exclude = NULL)

                             37-13                              67-14                              A0839 
                                 2                                 15                                  2 
                              A21b                                AB1                 Abditibacteriaceae 
                                 6                                  5                                  1 
                  Acetobacteraceae     Acidobacteriaceae (Subgroup 1)                    Acidothermaceae 
                               282                                140                                 42 
                           AKIW781                            AKYH767                     Alcaligenaceae 
                                 4                                  1                                  2 
                            B1-7BS                        Bacillaceae                 Bdellovibrionaceae 
                                 1                                  2                                  6 
                  Beijerinckiaceae                            BIrii41                  Blastocatellaceae 
                               487                                  3                                  3 
                Blattabacteriaceae                  Brevibacteriaceae                    Bryobacteraceae 
                                 4                                  1                                 18 
                  Burkholderiaceae                   Caedibacteraceae             Candidatus Jidaibacter 
                                23                                 15                                 11 
                  Caulobacteraceae                  Cellulomonadaceae                 Chitinibacteraceae 
                                70                                  1                                  1 
                 Chitinimonadaceae                   Chitinophagaceae                    Chloroflexaceae 
                                 1                                 69                                 45 
                Chromobacteriaceae                Chthoniobacteraceae                     Comamonadaceae 
                                 1                                  3                                 34 
                Corynebacteriaceae                Cryptosporangiaceae                  Cyclobacteriaceae 
                                 4                                  2                                  1 
                     Cytophagaceae                  Defluviicoccaceae                     Deinococcaceae 
                                 3                                  2                                 24 
                    Dermacoccaceae                        Devosiaceae                Diplorickettsiaceae 
                                 1                                  4                                  2 
                       Elsteraceae                 Enterobacteriaceae                         env.OPS 17 
                                 1                                  8                                  2 
                       Erwiniaceae                  Fimbriimonadaceae                  Flavobacteriaceae 
                                 6                                 20                                  1 
                       Fokiniaceae                        Frankiaceae                    Geminicoccaceae 
                                 2                                 75                                  3 
                 Gemmatimonadaceae                Geodermatophilaceae                      Haliangiaceae 
                                13                                  4                                 22 
                     Holophagaceae                  Hymenobacteraceae                  Hyphomicrobiaceae 
                                 1                                 15                                  6 
                   Hyphomonadaceae                          Iamiaceae                 Ilumatobacteraceae 
                                 1                                  6                                  9 
                     Inquilinaceae                 Intrasporangiaceae                        JG30-KF-AS9 
                                 3                                  6                                  2 
                      JG30-KF-CM45                             KD3-93                    Kineosporiaceae 
                                 4                                  2                                 26 
                Ktedonobacteraceae                          Labraceae                   Lactobacillaceae 
                                 5                                  3                                  2 
                 Longimicrobiaceae                               LWQ8                 Methyloligellaceae 
                                 1                                  7                                  1 
                   Methylopilaceae                   Micavibrionaceae                  Microbacteriaceae 
                                 1                                  4                                 33 
                    Micrococcaceae                 Micromonosporaceae                     Micropepsaceae 
                                 3                                 33                                 21 
                   Microscillaceae                      Moraxellaceae                     Morganellaceae 
                                 7                                 11                                  2 
                  Mycobacteriaceae                      Myxococcaceae                    Nakamurellaceae 
                                25                                 23                                  5 
                     Neisseriaceae                  Nitrosomonadaceae                    Nocardioidaceae 
                                 2                                  5                                 74 
                       Nostocaceae                     Oligoflexaceae                   Oxalobacteraceae 
                                 1                                  8                                 20 
                  Paenibacillaceae               Paracaedibacteraceae                  Parachlamydiaceae 
                                 4                                  6                                  4 
                   Pedosphaeraceae                 Phaselicystidaceae                      Polyangiaceae 
                                 6                                  4                                 15 
                 Procabacteriaceae               Propionibacteriaceae                   Pseudomonadaceae 
                                 1                                  7                                  6 
                Pseudonocardiaceae                     Reyranellaceae                       Rhizobiaceae 
                                97                                  5                                 18 
        Rhizobiales Incertae Sedis                 Rhodanobacteraceae                   Rhodobacteraceae 
                                 5                                 15                                  2 
                    Rhodocyclaceae                  Rhodomicrobiaceae                     Rickettsiaceae 
                                 4                                  2                                 11 
                    Roseiflexaceae                 Saccharimonadaceae           Salisediminibacteriaceae 
                                47                                 11                                  2 
                   Sandaracinaceae                            SC-I-84                  Silvanigrellaceae 
                                 1                                  1                                  1 
                      Simkaniaceae                             SM2D12                    Solibacteraceae 
                                 2                                 15                                 27 
                    Solimonadaceae               Solirubrobacteraceae                Sphingobacteriaceae 
                                 8                                 49                                 45 
                 Sphingomonadaceae                      Spirosomaceae                    Sporichthyaceae 
                               195                                159                                  2 
                 Staphylococcaceae                   Streptococcaceae                  Streptomycetaceae 
                                 5                                  3                                  8 
Streptosporangiales Incertae Sedis                     Sutterellaceae             Thermoanaerobaculaceae 
                                 2                                  2                                  1 
               Thermomonosporaceae                            TRA3-20                       Trueperaceae 
                                 3                                  1                                  1 
                  Tsukamurellaceae                     Unknown Family                      Weeksellaceae 
                                 1                                 18                                  8 
                 Xanthobacteraceae                   Xanthomonadaceae                       Yersiniaceae 
                                36                                  7                                  1 
                  YM_S32_TM7_50_20                               <NA> 
                                 3                                343 
> #number of taxa excluded after filtering
> ntaxa(bacteria.ps.norm.decont)-ntaxa(bacteria.ps.dataset.prev)
[1] 11949
> #prune OTUs that are not present in at least one sample
> ps.prev.exclude = prune_taxa(taxa_sums(bacteria.ps.dataset.prev) > 0, bacteria.ps.dataset.prev)
> ntaxa(ps.prev.exclude)
[1] 3099
> ##All taxa are present in at least one sample
> #Save the new dataset in a clean phyloseq object and in dataframe
> bacteria.ps.dataset = bacteria.ps.dataset.prev
> bacteria.df.dataset = phyloseq_to_df(bacteria.ps.dataset.prev, addtax = T, addtot = T, addmaxrank = T, sorting = "abundance")
Error in phyloseq_to_df(bacteria.ps.dataset.prev, addtax = T, addtot = T,  : 
  Error: Sample names in 'physeq' could not be automatically converted to the syntactically valid column names in data.frame (see 'make.names'). Consider renaming with 'sample_names'.
> View(bacteria.ps.dataset.prev)
> View(Sample_list)
> sample_names(bacteria.ps.dataset.prev) <- gsub(pattern = "-", replacement = "_", x = sample_names(bacteria.ps.dataset.prev))
> bacteria.df.dataset = phyloseq_to_df(bacteria.ps.dataset.prev, addtax = T, addtot = T, addmaxrank = T, sorting = "abundance")
Error in phyloseq_to_df(bacteria.ps.dataset.prev, addtax = T, addtot = T,  : 
  Error: Sample names in 'physeq' could not be automatically converted to the syntactically valid column names in data.frame (see 'make.names'). Consider renaming with 'sample_names'.
> psd <- phyloseq_to_df(bacteria.ps.dataset.prev)
Error in phyloseq_to_df(bacteria.ps.dataset.prev) : 
  Error: Sample names in 'physeq' could not be automatically converted to the syntactically valid column names in data.frame (see 'make.names'). Consider renaming with 'sample_names'.
> ## or
> ##rename samples back
> sample_names(bacteria.ps.dataset.prev) <- paste0("z_", sample_names(bacteria.ps.dataset.prev))
> psd <- phyloseq_to_df(bacteria.ps.dataset.prev)
> bacteria.df.dataset = phyloseq_to_df(bacteria.ps.dataset.prev, addtax = T, addtot = T, addmaxrank = T, sorting = "abundance")
  |====================================================================================================| 100%
> str(bacteria.ps.dataset)
Formal class 'phyloseq' [package "phyloseq"] with 5 slots
  ..@ otu_table:Formal class 'otu_table' [package "phyloseq"] with 2 slots
  .. .. ..@ .Data        : int [1:3099, 1:118] 0 0 0 0 0 0 0 0 0 0 ...
  .. .. .. ..- attr(*, "dimnames")=List of 2
  .. .. .. .. ..$ : chr [1:3099] "ASV1" "ASV2" "ASV3" "ASV4" ...
  .. .. .. .. ..$ : chr [1:118] "16S-BLANCO1" "16S-BLANCO2" "16S-MEC-01-1" "16S-MEC-01-2" ...
  .. .. ..@ taxa_are_rows: logi TRUE
  .. .. ..$ dim     : int [1:2] 3099 118
  .. .. ..$ dimnames:List of 2
  .. .. .. ..$ : chr [1:3099] "ASV1" "ASV2" "ASV3" "ASV4" ...
  .. .. .. ..$ : chr [1:118] "16S-BLANCO1" "16S-BLANCO2" "16S-MEC-01-1" "16S-MEC-01-2" ...
  ..@ tax_table:Formal class 'taxonomyTable' [package "phyloseq"] with 1 slot
  .. .. ..@ .Data: chr [1:3099, 1:7] "Bacteria" "Bacteria" "Bacteria" "Bacteria" ...
  .. .. .. ..- attr(*, "dimnames")=List of 2
  .. .. .. .. ..$ : chr [1:3099] "ASV1" "ASV2" "ASV3" "ASV4" ...
  .. .. .. .. ..$ : chr [1:7] "Kingdom" "Phylum" "Class" "Order" ...
  .. .. ..$ dim     : int [1:2] 3099 7
  .. .. ..$ dimnames:List of 2
  .. .. .. ..$ : chr [1:3099] "ASV1" "ASV2" "ASV3" "ASV4" ...
  .. .. .. ..$ : chr [1:7] "Kingdom" "Phylum" "Class" "Order" ...
  ..@ sam_data :'data.frame':	118 obs. of  30 variables:
Formal class 'sample_data' [package "phyloseq"] with 4 slots
  .. .. ..@ .Data    :List of 30
  .. .. .. ..$ : Factor w/ 2 levels "NA","Zamiaceae": 1 1 2 2 2 2 2 2 2 2 ...
  .. .. .. ..$ : Factor w/ 2 levels "NA","Zamia pseudoparasitica": 1 1 2 2 2 2 2 2 2 2 ...
  .. .. .. ..$ : logi [1:118] FALSE FALSE FALSE FALSE FALSE FALSE ...
  .. .. .. ..$ : Factor w/ 3 levels "Dry","NA","Rainy": 2 2 1 1 1 1 1 1 1 1 ...
  .. .. .. ..$ : Factor w/ 8 levels "16-10-2022","19-03-2023",..: 8 8 7 7 7 7 7 7 7 7 ...
  .. .. .. ..$ : Factor w/ 2 levels "NA","Panamá": 1 1 2 2 2 2 2 2 2 2 ...
  .. .. .. ..$ : Factor w/ 4 levels "Bocas del Toro",..: 3 3 2 2 2 2 2 2 2 2 ...
  .. .. .. ..$ : Factor w/ 5 levels "Bosque Protector Palo Seco (Finca Sr. Desiderio",..: 3 3 4 4 4 4 4 4 4 4 ...
  .. .. .. ..$ : Factor w/ 20 levels "8.5291169999999994",..: 20 20 6 6 7 7 8 8 9 9 ...
  .. .. .. ..$ : Factor w/ 19 levels "-80.590299999999999",..: 19 19 3 3 5 5 4 4 6 6 ...
  .. .. .. ..$ : Factor w/ 20 levels "506","542","566",..: 20 20 10 10 12 12 9 9 11 11 ...
  .. .. .. ..$ : Factor w/ 7 levels "10","5","6","7",..: 7 7 2 2 5 5 2 2 2 2 ...
  .. .. .. ..$ : Factor w/ 9 levels "10","11","3",..: 9 9 5 5 1 1 5 5 8 8 ...
  .. .. .. ..$ : Factor w/ 3 levels "F","NA","NI": 2 2 3 3 3 3 1 1 3 3 ...
  .. .. .. ..$ : Factor w/ 3 levels "0","1","NA": 3 3 1 1 1 1 2 2 1 1 ...
  .. .. .. ..$ : Factor w/ 112 levels "10.052","10.121",..: 112 112 87 77 1 22 108 15 49 12 ...
  .. .. .. ..$ : Factor w/ 58 levels "28.94","44.53",..: 58 58 19 19 6 6 35 35 11 11 ...
  .. .. .. ..$ : Factor w/ 15 levels "100","59.9","77.099999999999994",..: 15 15 1 1 1 1 1 1 1 1 ...
  .. .. .. ..$ : Factor w/ 34 levels "19.5","19.600000000000001",..: 34 34 2 2 3 3 7 7 8 8 ...
  .. .. .. ..$ : Factor w/ 62 levels "17.3","17.5",..: 62 62 4 1 9 14 14 12 16 15 ...
  .. .. .. ..$ : Factor w/ 56 levels "0.1111111111111111",..: 56 56 26 26 27 27 28 28 31 31 ...
  .. .. .. ..$ : Factor w/ 59 levels "-0.4","-0.5",..: 10 25 52 24 28 32 50 24 19 28 ...
  .. .. .. ..$ : Factor w/ 1 level "DNeasy Power Soil (Quiagen)": 1 1 1 1 1 1 1 1 1 1 ...
  .. .. .. ..$ : Factor w/ 82 levels "-1.49","0.21",..: 8 44 57 41 44 36 25 48 41 36 ...
  .. .. .. ..$ : Factor w/ 70 levels "-0.12","-0.14000000000000001",..: 11 53 58 41 34 36 53 46 22 47 ...
  .. .. .. ..$ : Factor w/ 4 levels "A. Sierra","L. Rodriguez",..: 2 2 2 2 2 2 2 2 2 2 ...
  .. .. .. ..$ : Factor w/ 3 levels "30","50","60": 2 2 2 2 2 2 2 2 2 2 ...
  .. .. .. ..$ : Factor w/ 15 levels "13-05-2023","21-11-2022",..: 9 11 8 8 12 8 8 8 12 13 ...
  .. .. .. ..$ : num [1:118] 14.2 14.2 14.2 14.2 14.2 14.2 14.2 14.2 14.2 14.2 ...
  .. .. .. ..$ : Factor w/ 118 levels "16S-BLANCO1",..: 1 2 3 4 5 6 7 8 9 10 ...
  .. .. ..@ names    : chr [1:30] "Family" "Specie" "isneg" "Season" ...
  .. .. ..@ row.names: chr [1:118] "16S-BLANCO1" "16S-BLANCO2" "16S-MEC-01-1" "16S-MEC-01-2" ...
  .. .. ..@ .S3Class : chr "data.frame"
  ..@ phy_tree : NULL
  ..@ refseq   :Formal class 'DNAStringSet' [package "Biostrings"] with 5 slots
  .. .. ..@ pool           :Formal class 'SharedRaw_Pool' [package "XVector"] with 2 slots
  .. .. .. .. ..@ xp_list                    :List of 1
  .. .. .. .. .. ..$ :<externalptr> 
  .. .. .. .. ..@ .link_to_cached_object_list:List of 1
  .. .. .. .. .. ..$ :<environment: 0x14584add8> 
  .. .. ..@ ranges         :Formal class 'GroupedIRanges' [package "XVector"] with 7 slots
  .. .. .. .. ..@ group          : int [1:3099] 1 1 1 1 1 1 1 1 1 1 ...
  .. .. .. .. ..@ start          : int [1:3099] 1 304 607 907 1206 1505 1805 2103 2403 2702 ...
  .. .. .. .. ..@ width          : int [1:3099] 303 303 300 299 299 300 298 300 299 298 ...
  .. .. .. .. ..@ NAMES          : chr [1:3099] "ASV1" "ASV2" "ASV3" "ASV4" ...
  .. .. .. .. ..@ elementType    : chr "ANY"
  .. .. .. .. ..@ elementMetadata: NULL
  .. .. .. .. ..@ metadata       : list()
  .. .. ..@ elementType    : chr "DNAString"
  .. .. ..@ elementMetadata: NULL
  .. .. ..@ metadata       : list()
> saveRDS(bacteria.ps.dataset, "bacteria_ps_dataset_March01_16S.rds")
> ###Read process Phyloseq object for following analysis
> bacteria.ps.dataset = readRDS("bacteria_ps_dataset_March01_16S.rds")
> refseq(bacteria.ps.dataset)
DNAStringSet object of length 3099:
       width seq                                                                          names               
   [1]   303 GTAGTCCACGCCGTAAACGATGGATGCTAGCCGTTGG...GTCAGCTCGTGTCGTGAGATGTTGGGTTAAGTCCCG ASV1
   [2]   303 GTAGTCCACGCCCTAAACGATGGATGCTAGCCGTTAG...GTCAGCTCGTGTCGTGAGATGTTGGGTTAAGTCCCG ASV2
   [3]   300 GTAGTCCACGCCGTAAACGGTGGGTACTAGGTGTGGG...GTCAGCTCGTGTCGTGAGATGTTGGGTTAAGTCCCG ASV3
   [4]   299 GTAGTCCACGCTGTAAACGATGAGAGCTAGTTGTCGG...GTCAGCTCGTGTCGTGAGATGTTGGGTTAAGTCCCG ASV4
   [5]   299 GTAGTCCACGCTGTAAACGATGAGTGCTAGTTGTCGG...GTCAGCTCGTGTCGTGAGATGTTGGGTTAAGTCCCG ASV5
   ...   ... ...
[3095]   300 GTAGTCCACGCTGTAAACTATGAGTGCTAGGCGTTGC...GTCAGCTCGTGTCGTGAGATGTTGGGTTAAGTCCCG ASV7872
[3096]   302 GTAGTCCACGCCTTAAACGATGGATGCTAGCCGTCGG...GTCAGCTCGTGTCGTGAGATGTTGGGTTAAGTCCCG ASV8001
[3097]   301 GTAGTCCGCACCGTAAACGATGGATACTAGGCGTTCG...GTCAGCTCGTGTTGTGAAATGTTCGGTTAAGTCCGG ASV8128
[3098]   275 GTAGTCCACGCCCTAAACGATGAGAACTAGACATTGC...GTAAGCTCGTGTCGTAAGATGTTGGGTTAAGTCCCG ASV8688
[3099]   306 GTAGTCCACGCCGTAAACGATGAGCACTAGGTGGATG...GTCAGCTCGTGCCGTGAGGTGTTAGGTTAAGTCCTT ASV8854
> #### DESEQ2 ####
> bacteria.ps.norm.decont
phyloseq-class experiment-level object
otu_table()   OTU Table:         [ 15048 taxa and 118 samples ]
sample_data() Sample Data:       [ 118 samples by 30 sample variables ]
tax_table()   Taxonomy Table:    [ 15048 taxa by 7 taxonomic ranks ]
refseq()      DNAStringSet:      [ 15048 reference sequences ]
> View(sample_data(bacteria.ps.dataset))
> ##Names of our ASVs
> taxa_names(bacteria.ps.dataset)[1:10]
 [1] "ASV1"  "ASV2"  "ASV3"  "ASV4"  "ASV5"  "ASV6"  "ASV7"  "ASV8"  "ASV9"  "ASV10"
> sample_sums(bacteria.ps.dataset)
 16S-BLANCO1  16S-BLANCO2 16S-MEC-01-1 16S-MEC-01-2 16S-MEC-02-1 16S-MEC-02-2 16S-MEC-03-1 16S-MEC-03-2 
        2595        14519        12504        19352        14746         8136        11608        26386 
16S-MEC-04-1 16S-MEC-04-2 16S-MEC-05-1 16S-MEC-05-2 16S-MEC-06-1 16S-MEC-07-1 16S-MEC-07-2 16S-MEC-08-1 
       17076        44774        14245        13930        12262        16384         7402        17969 
16S-MEC-08-2 16S-MEC-09-1 16S-MEC-09-2 16S-MEC-10-1 16S-MEC-10-2 16S-MPS-01-1 16S-MPS-01-2 16S-MPS-02-1 
       14434        17530        16167        18636        14677        15911        18348        23981 
16S-MPS-02-2 16S-MPS-03-1 16S-MPS-03-2 16S-MPS-04-1 16S-MPS-04-2 16S-MPS-05-1 16S-MPS-05-2 16S-MPS-06-1 
       22637        10705         6294        15320        13063        44556        32715        21014 
16S-MPS-06-2 16S-MPS-07-1 16S-MPS-07-2 16S-MPS-08-2 16S-MPS-21-1 16S-MPS-21-2 16S-MPS-29-1 16S-MPS-29-2 
       14928        25474        35263        51651        33358        27156        31750        40032 
16S-MSF-07-1 16S-MSF-07-2 16S-MSF-08-1 16S-MSF-08-2 16S-MSF-09-1 16S-MSF-09-2 16S-MSF-10-1 16S-MSF-10-2 
       12104         9658        17192        13994        18441         6277        22519        19449 
16S-MSF-11-1 16S-MSF-11-2 16S-MSF-17-1 16S-MSF-17-2 16S-MSF-18-1 16S-MSF-18-2 16S-MSF-19-2 16S-MSF-21-1 
       12610        11922        16429        19236        13754        10237        20172        11332 
16S-MSF-21-2 16S-MSF-22-1 16S-MSF-22-2 16S-OEC-01-1 16S-OEC-01-2 16S-OEC-02-1 16S-OEC-02-2 16S-OEC-03-1 
        4148        26771        12548        23881        16758        23573        16069        23195 
16S-OEC-03-2 16S-OEC-04-1 16S-OEC-04-2 16S-OEC-05-1 16S-OEC-05-2 16S-OEC-06-1 16S-OEC-06-2 16S-OEC-07-1 
       18070        19174        21054        22506        19446        19702        17491        10986 
16S-OEC-07-2 16S-OEC-08-1 16S-OEC-08-2 16S-OEC-09-1 16S-OEC-09-2 16S-OEC-10-1 16S-OEC-10-2 16S-OPS-01-1 
       18622        30576        22122        16921        19456        23677        16021        21153 
16S-OPS-01-2 16S-OPS-02-1 16S-OPS-02-2 16S-OPS-03-1 16S-OPS-03-2 16S-OPS-04-1 16S-OPS-04-2 16S-OPS-05-1 
        9317        15610        43131        13318        13160          939        12454        10860 
16S-OPS-05-2 16S-OPS-06-1 16S-OPS-06-2 16S-OPS-07-1 16S-OPS-07-2 16S-OPS-08-1 16S-OPS-08-2 16S-OPS-21-1 
       25292        28228        20935        47319        46003        30936        44285        38403 
16S-OPS-29-1 16S-OPS-29-2 16S-OSF-07-1 16S-OSF-07-2 16S-OSF-08-1 16S-OSF-08-2 16S-OSF-09-1 16S-OSF-09-2 
       11526        44203        10911        18409         7398        17418         3665         3007 
16S-OSF-10-1 16S-OSF-10-2 16S-OSF-11-1 16S-OSF-11-2 16S-OSF-17-1 16S-OSF-17-2 16S-OSF-18-1 16S-OSF-18-2 
       14429        19167         8418        19702        17761        13420        15271        10670 
16S-OSF-19-1 16S-OSF-19-2 16S-OSF-21-1 16S-OSF-21-2 16S-OSF-22-1 16S-OSF-22-2 
       10473        19170        17227        10805        13984        10301 
> hist(sample_sums(bacteria.ps.dataset), breaks = 100)
> ##Convert to DESeq2
> ##remove samples with less than >4000 reads (counts)
> ##We use our categorical explanatory variable: species
> bacteria.ps.dataset.norm <- prune_samples(sample_sums(bacteria.ps.dataset) > 100, bacteria.ps.dataset)
> sample_sums(bacteria.ps.dataset.norm)
 16S-BLANCO1  16S-BLANCO2 16S-MEC-01-1 16S-MEC-01-2 16S-MEC-02-1 16S-MEC-02-2 16S-MEC-03-1 16S-MEC-03-2 
        2595        14519        12504        19352        14746         8136        11608        26386 
16S-MEC-04-1 16S-MEC-04-2 16S-MEC-05-1 16S-MEC-05-2 16S-MEC-06-1 16S-MEC-07-1 16S-MEC-07-2 16S-MEC-08-1 
       17076        44774        14245        13930        12262        16384         7402        17969 
16S-MEC-08-2 16S-MEC-09-1 16S-MEC-09-2 16S-MEC-10-1 16S-MEC-10-2 16S-MPS-01-1 16S-MPS-01-2 16S-MPS-02-1 
       14434        17530        16167        18636        14677        15911        18348        23981 
16S-MPS-02-2 16S-MPS-03-1 16S-MPS-03-2 16S-MPS-04-1 16S-MPS-04-2 16S-MPS-05-1 16S-MPS-05-2 16S-MPS-06-1 
       22637        10705         6294        15320        13063        44556        32715        21014 
16S-MPS-06-2 16S-MPS-07-1 16S-MPS-07-2 16S-MPS-08-2 16S-MPS-21-1 16S-MPS-21-2 16S-MPS-29-1 16S-MPS-29-2 
       14928        25474        35263        51651        33358        27156        31750        40032 
16S-MSF-07-1 16S-MSF-07-2 16S-MSF-08-1 16S-MSF-08-2 16S-MSF-09-1 16S-MSF-09-2 16S-MSF-10-1 16S-MSF-10-2 
       12104         9658        17192        13994        18441         6277        22519        19449 
16S-MSF-11-1 16S-MSF-11-2 16S-MSF-17-1 16S-MSF-17-2 16S-MSF-18-1 16S-MSF-18-2 16S-MSF-19-2 16S-MSF-21-1 
       12610        11922        16429        19236        13754        10237        20172        11332 
16S-MSF-21-2 16S-MSF-22-1 16S-MSF-22-2 16S-OEC-01-1 16S-OEC-01-2 16S-OEC-02-1 16S-OEC-02-2 16S-OEC-03-1 
        4148        26771        12548        23881        16758        23573        16069        23195 
16S-OEC-03-2 16S-OEC-04-1 16S-OEC-04-2 16S-OEC-05-1 16S-OEC-05-2 16S-OEC-06-1 16S-OEC-06-2 16S-OEC-07-1 
       18070        19174        21054        22506        19446        19702        17491        10986 
16S-OEC-07-2 16S-OEC-08-1 16S-OEC-08-2 16S-OEC-09-1 16S-OEC-09-2 16S-OEC-10-1 16S-OEC-10-2 16S-OPS-01-1 
       18622        30576        22122        16921        19456        23677        16021        21153 
16S-OPS-01-2 16S-OPS-02-1 16S-OPS-02-2 16S-OPS-03-1 16S-OPS-03-2 16S-OPS-04-1 16S-OPS-04-2 16S-OPS-05-1 
        9317        15610        43131        13318        13160          939        12454        10860 
16S-OPS-05-2 16S-OPS-06-1 16S-OPS-06-2 16S-OPS-07-1 16S-OPS-07-2 16S-OPS-08-1 16S-OPS-08-2 16S-OPS-21-1 
       25292        28228        20935        47319        46003        30936        44285        38403 
16S-OPS-29-1 16S-OPS-29-2 16S-OSF-07-1 16S-OSF-07-2 16S-OSF-08-1 16S-OSF-08-2 16S-OSF-09-1 16S-OSF-09-2 
       11526        44203        10911        18409         7398        17418         3665         3007 
16S-OSF-10-1 16S-OSF-10-2 16S-OSF-11-1 16S-OSF-11-2 16S-OSF-17-1 16S-OSF-17-2 16S-OSF-18-1 16S-OSF-18-2 
       14429        19167         8418        19702        17761        13420        15271        10670 
16S-OSF-19-1 16S-OSF-19-2 16S-OSF-21-1 16S-OSF-21-2 16S-OSF-22-1 16S-OSF-22-2 
       10473        19170        17227        10805        13984        10301 
> hist(sample_sums(bacteria.ps.dataset.norm), breaks = 100)
> (sample_sums(bacteria.ps.dataset) > 100) == TRUE
 16S-BLANCO1  16S-BLANCO2 16S-MEC-01-1 16S-MEC-01-2 16S-MEC-02-1 16S-MEC-02-2 16S-MEC-03-1 16S-MEC-03-2 
        TRUE         TRUE         TRUE         TRUE         TRUE         TRUE         TRUE         TRUE 
16S-MEC-04-1 16S-MEC-04-2 16S-MEC-05-1 16S-MEC-05-2 16S-MEC-06-1 16S-MEC-07-1 16S-MEC-07-2 16S-MEC-08-1 
        TRUE         TRUE         TRUE         TRUE         TRUE         TRUE         TRUE         TRUE 
16S-MEC-08-2 16S-MEC-09-1 16S-MEC-09-2 16S-MEC-10-1 16S-MEC-10-2 16S-MPS-01-1 16S-MPS-01-2 16S-MPS-02-1 
        TRUE         TRUE         TRUE         TRUE         TRUE         TRUE         TRUE         TRUE 
16S-MPS-02-2 16S-MPS-03-1 16S-MPS-03-2 16S-MPS-04-1 16S-MPS-04-2 16S-MPS-05-1 16S-MPS-05-2 16S-MPS-06-1 
        TRUE         TRUE         TRUE         TRUE         TRUE         TRUE         TRUE         TRUE 
16S-MPS-06-2 16S-MPS-07-1 16S-MPS-07-2 16S-MPS-08-2 16S-MPS-21-1 16S-MPS-21-2 16S-MPS-29-1 16S-MPS-29-2 
        TRUE         TRUE         TRUE         TRUE         TRUE         TRUE         TRUE         TRUE 
16S-MSF-07-1 16S-MSF-07-2 16S-MSF-08-1 16S-MSF-08-2 16S-MSF-09-1 16S-MSF-09-2 16S-MSF-10-1 16S-MSF-10-2 
        TRUE         TRUE         TRUE         TRUE         TRUE         TRUE         TRUE         TRUE 
16S-MSF-11-1 16S-MSF-11-2 16S-MSF-17-1 16S-MSF-17-2 16S-MSF-18-1 16S-MSF-18-2 16S-MSF-19-2 16S-MSF-21-1 
        TRUE         TRUE         TRUE         TRUE         TRUE         TRUE         TRUE         TRUE 
16S-MSF-21-2 16S-MSF-22-1 16S-MSF-22-2 16S-OEC-01-1 16S-OEC-01-2 16S-OEC-02-1 16S-OEC-02-2 16S-OEC-03-1 
        TRUE         TRUE         TRUE         TRUE         TRUE         TRUE         TRUE         TRUE 
16S-OEC-03-2 16S-OEC-04-1 16S-OEC-04-2 16S-OEC-05-1 16S-OEC-05-2 16S-OEC-06-1 16S-OEC-06-2 16S-OEC-07-1 
        TRUE         TRUE         TRUE         TRUE         TRUE         TRUE         TRUE         TRUE 
16S-OEC-07-2 16S-OEC-08-1 16S-OEC-08-2 16S-OEC-09-1 16S-OEC-09-2 16S-OEC-10-1 16S-OEC-10-2 16S-OPS-01-1 
        TRUE         TRUE         TRUE         TRUE         TRUE         TRUE         TRUE         TRUE 
16S-OPS-01-2 16S-OPS-02-1 16S-OPS-02-2 16S-OPS-03-1 16S-OPS-03-2 16S-OPS-04-1 16S-OPS-04-2 16S-OPS-05-1 
        TRUE         TRUE         TRUE         TRUE         TRUE         TRUE         TRUE         TRUE 
16S-OPS-05-2 16S-OPS-06-1 16S-OPS-06-2 16S-OPS-07-1 16S-OPS-07-2 16S-OPS-08-1 16S-OPS-08-2 16S-OPS-21-1 
        TRUE         TRUE         TRUE         TRUE         TRUE         TRUE         TRUE         TRUE 
16S-OPS-29-1 16S-OPS-29-2 16S-OSF-07-1 16S-OSF-07-2 16S-OSF-08-1 16S-OSF-08-2 16S-OSF-09-1 16S-OSF-09-2 
        TRUE         TRUE         TRUE         TRUE         TRUE         TRUE         TRUE         TRUE 
16S-OSF-10-1 16S-OSF-10-2 16S-OSF-11-1 16S-OSF-11-2 16S-OSF-17-1 16S-OSF-17-2 16S-OSF-18-1 16S-OSF-18-2 
        TRUE         TRUE         TRUE         TRUE         TRUE         TRUE         TRUE         TRUE 
16S-OSF-19-1 16S-OSF-19-2 16S-OSF-21-1 16S-OSF-21-2 16S-OSF-22-1 16S-OSF-22-2 
        TRUE         TRUE         TRUE         TRUE         TRUE         TRUE 
> #Normalized non raredied data
> table(bacteria.ps.norm.decont@sam_data$Season)

  Dry    NA Rainy 
   57     2    59 
> table(bacteria.ps.norm.decont@sam_data$Site)

          Bosque Protector Palo Seco (Finca Sr. Desiderio 
                                                       18 
                 Bosque Protector Palo Seco (Willie Mazu) 
                                                       20 
                                                       NA 
                                                        2 
Parque Nacional General de División Omar Torrijos Herrera 
                                                       39 
                                 Parque Nacional Santa Fe 
                                                       39 
> table(bacteria.ps.norm.decont@sam_data$Plant.height_m)

10  5  6  7  8  9 NA 
 8 49 27  4 16 12  2 
> table(bacteria.ps.norm.decont@sam_data$Size_No.of.leaf)

10 11  3  4  5  6  7  8 NA 
12  7  4  7 38 12 20 16  2 
> table(bacteria.ps.norm.decont@sam_data$RH)

               100               59.9 77.099999999999994               79.3                 93 
                78                  2                  4                  4                  4 
              95.2               95.6                 97               97.1               98.3 
                 2                  2                  2                  4                  2 
              98.6               99.1               99.4               99.9                 NA 
                 1                  2                  2                  2                  7 
> bacteria.ps.dataset.norm.deseq <- phyloseq_to_deseq2(bacteria.ps.norm.decont, ~Site)
converting counts to integer mode
  Note: levels of factors in the design contain characters other than
  letters, numbers, '_' and '.'. It is recommended (but not required) to use
  only letters, numbers, and delimiters '_' or '.', as these are safe characters
  for column names in R. [This is a message, not a warning or an error]
> ## Calculate geometric means prior to estimate size factors
> ## define a function to calculate the geometric mean
> gm_mean = function(x, na.rm=TRUE){
+   exp(sum(log(x[x > 0]), na.rm=na.rm) / length(x))
+ }
> ## Calculate the geometric mean for each gene using that function
> ##note the use of apply(), which we instruct to apply the gm_mean()
> ## function per row (this is what the second parameter, 1, indicates)
> geoMeans = apply(counts(bacteria.ps.dataset.norm.deseq), 1, gm_mean)
> #
> #
> counts(bacteria.ps.dataset.norm.deseq)
         16S-BLANCO1 16S-BLANCO2 16S-MEC-01-1 16S-MEC-01-2 16S-MEC-02-1 16S-MEC-02-2 16S-MEC-03-1
ASV1               0         174          254          444          713          410          475
ASV2               0          41           61           63          142          173           30
ASV3               0         191          112          168          249          237          356
ASV4               0         201           85          115          173          115           28
ASV5               0         257           95          128          187           83           37
ASV6               0           0            0            0            0          154            0
ASV7               0           0           86           67          139          251          171
ASV8               0          40          161          206           90           50            0
         16S-MEC-03-2 16S-MEC-04-1 16S-MEC-04-2 16S-MEC-05-1 16S-MEC-05-2 16S-MEC-06-1 16S-MEC-07-1
ASV1              928          600          350          873          759          318          360
ASV2              155          866            0          298          206            0          306
ASV3              827           54          289          264           94          299          223
ASV4              292           75           81          769          488           59          286
ASV5              303            0          116          174          131           48           68
ASV6               71          535          193            0            0          113            0
ASV7              760          146          107           39          109          180          144
ASV8               81           32          416            0          161           77           65
         16S-MEC-07-2 16S-MEC-08-1 16S-MEC-08-2 16S-MEC-09-1 16S-MEC-09-2 16S-MEC-10-1 16S-MEC-10-2
ASV1              165          539          109          863         1061          664          603
ASV2              111          784           33          204          116          174          110
ASV3                0           57            0          170          251           81           54
ASV4              157          145          112          401          227           95          125
ASV5               30            0           47          194          173          216          208
ASV6                0          402            0          134          157          271          190
ASV7               43          174            0          237          140           69           44
ASV8               43           83          160          422          535          321          269
         16S-MPS-01-1 16S-MPS-01-2 16S-MPS-02-1 16S-MPS-02-2 16S-MPS-03-1 16S-MPS-03-2 16S-MPS-04-1
ASV1              208          268          314          563          198           50          104
ASV2               28           54          419          287           47           31          158
ASV3               89          301           93          230          154           88          119
ASV4               69          385          401          200           55          167          308
ASV5              216          207          341          312          123          111          259
ASV6                0          138          333          187            0          157            0
ASV7                0          110           47          134           20            0           32
ASV8              271           57          151          369          165          133           85
         16S-MPS-04-2 16S-MPS-05-1 16S-MPS-05-2 16S-MPS-06-1 16S-MPS-06-2 16S-MPS-07-1 16S-MPS-07-2
ASV1              120          580          193          126          222            0          124
ASV2              108          106           45           48          339          400           51
ASV3              102          744          511          216           82            0            0
ASV4              301          815          123          123          528          335          459
ASV5              198          478          399          452          295          262          226
ASV6                0          294           96            0          645            0            0
ASV7                0          518           68            0          209            0           15
ASV8               91           92          254          139           43           75          181
         16S-MPS-08-2 16S-MPS-21-1 16S-MPS-21-2 16S-MPS-29-1 16S-MPS-29-2 16S-MSF-07-1 16S-MSF-07-2
ASV1             1269          569          285            0         1267          495          235
ASV2              725          161           53          668          109           56           56
ASV3              942            0            0            0          341           89           71
ASV4             1024          604          321          369          312          147           42
ASV5              574           67           84          399          299           39            0
ASV6              337          150            0          195           40            0            0
ASV7             2078            5            0           72          138           68           75
ASV8              602          274          199           86          310          225          221
         16S-MSF-08-1 16S-MSF-08-2 16S-MSF-09-1 16S-MSF-09-2 16S-MSF-10-1 16S-MSF-10-2 16S-MSF-11-1
ASV1              150          161          353          352         1255          886          478
ASV2               42          127           80           49          283           92          620
ASV3              335          387          198          183          251          253          383
ASV4               40           59          275           34          174           60            6
ASV5              200          134          227           45          305          256            0
ASV6                0          138          262            0          450          298          876
ASV7               35          174          106          131          525          577         1729
ASV8              101          109           39          155          400          433            0
         16S-MSF-11-2 16S-MSF-17-1 16S-MSF-17-2 16S-MSF-18-1 16S-MSF-18-2 16S-MSF-19-2 16S-MSF-21-1
ASV1              640          880         1059          584          477          904          252
ASV2              666          141          282          235          173          969          786
ASV3              327          220          266          138          221          285          474
ASV4               58           47          140          255          154          371           24
ASV5               42          110          349          116          118          192            0
ASV6              771          113          132          171          134          508          775
ASV7              577          405          509          154          301          579          381
ASV8               64          377          276          173          201           71           43
         16S-MSF-21-2 16S-MSF-22-1 16S-MSF-22-2 16S-OEC-01-1 16S-OEC-01-2 16S-OEC-02-1 16S-OEC-02-2
ASV1              161          244          345         1297         1145          717          635
ASV2              258           48          268          218          197          202          118
ASV3              217          159          227          449          485          351           72
ASV4                0           94           98          169          139          122           65
ASV5                0          264          382          222          299           94           94
ASV6              427          112          208          143            0          239            0
ASV7              222            0          400           53           54          321           59
ASV8               60          395          354          168           79          576          520
         16S-OEC-03-1 16S-OEC-03-2 16S-OEC-04-1 16S-OEC-04-2 16S-OEC-05-1 16S-OEC-05-2 16S-OEC-06-1
ASV1             1525         1863         1901         1754          521          267          647
ASV2              322          547          208          377          129           51          123
ASV3              439          221          116          300          173          183          254
ASV4              176          388          100          184           25           26           75
ASV5              210          271          181          314           81           76          110
ASV6              194          298            0            0            0            0           86
ASV7              193          124           33           90           89           87           79
ASV8              168          159          129          219          242          143          192
         16S-OEC-06-2 16S-OEC-07-1 16S-OEC-07-2 16S-OEC-08-1 16S-OEC-08-2 16S-OEC-09-1 16S-OEC-09-2
ASV1              628          709          830          774          591          330          819
ASV2              150          130          101          209          111           68          195
ASV3              240          162          178          483          445          151          187
ASV4              128          368          125          121          134           32          397
ASV5              141           62          176          129           48           29          145
ASV6               96          137          110            0            0            0          138
ASV7              139           36           49           70           50           56           42
ASV8              141           85          271           72            0          145          188
         16S-OEC-10-1 16S-OEC-10-2 16S-OPS-01-1 16S-OPS-01-2 16S-OPS-02-1 16S-OPS-02-2 16S-OPS-03-1
ASV1              702          423          285          123          263          433          175
ASV2              132           66          124           41           62          133           57
ASV3              183          169          191           59          194          185           80
ASV4              162           61          515          226           27          253          180
ASV5              198           82          560          284          156          236          143
ASV6              138            0          321          110            0          204          135
ASV7               65            0           61            0           35            0            0
ASV8              315          229          181            0          176          159           54
         16S-OPS-03-2 16S-OPS-04-1 16S-OPS-04-2 16S-OPS-05-1 16S-OPS-05-2 16S-OPS-06-1 16S-OPS-06-2
ASV1              160            0          262            0           90          169          104
ASV2               61           24           39            0            0          433          358
ASV3              108            0          118          276          420           82           69
ASV4              103           28           14            0           39          767          519
ASV5              172            0           72           78          232          623          478
ASV6              163            0            0            0          139          414          284
ASV7                0            0           28          169          122          213          111
ASV8              150            0          134           25           34          119           80
         16S-OPS-07-1 16S-OPS-07-2 16S-OPS-08-1 16S-OPS-08-2 16S-OPS-21-1 16S-OPS-29-1 16S-OPS-29-2
ASV1                0          515          510          122          433          141          151
ASV2             1754          155          775         1088          808           28          778
ASV3               74          474          161            0          278            0          471
ASV4              855           11          815          342          846          115          220
ASV5              581          299          295          620          371           71          578
ASV6             1763            0          327         1681          360            0          443
ASV7              384           50          211          340          116            0          486
ASV8               26          673          215            0          357          100          106
         16S-OSF-07-1 16S-OSF-07-2 16S-OSF-08-1 16S-OSF-08-2 16S-OSF-09-1 16S-OSF-09-2 16S-OSF-10-1
ASV1              994         1176           93          831            0            0          438
ASV2              122          168            0          205          143            0          189
ASV3              173          285          131          315            0            0          184
ASV4               47           77           52          103          145           33          282
ASV5              151          170          100          233           26            0          331
ASV6                0           93            0          642            0            0          187
ASV7               33           84          100          514            0            0           81
ASV8              161          162           18          244            0            0          151
         16S-OSF-10-2 16S-OSF-11-1 16S-OSF-11-2 16S-OSF-17-1 16S-OSF-17-2 16S-OSF-18-1 16S-OSF-18-2
ASV1              454           65          149          722          751          886           95
ASV2              388            0           31          225          146          319           53
ASV3              548           79          469          686          517          196          218
ASV4               21          104           37           93           72          102           48
ASV5              170          155          299          159          218          170          134
ASV6              977           38            0          128            0          388            0
ASV7              748           11          125          254          216          269           30
ASV8              220           30           79          424          252          395           57
         16S-OSF-19-1 16S-OSF-19-2 16S-OSF-21-1 16S-OSF-21-2 16S-OSF-22-1 16S-OSF-22-2
ASV1              528          794          813          258          256          174
ASV2              237          241         1433          160           75          220
ASV3              248          443          446          435           96          156
ASV4               55          141            0           94          114          308
ASV5               98          229           95          282           72          335
ASV6              415          335          909            0            0          221
ASV7              118          308          363          393           32           94
ASV8              236          272           54          333          221           14
 [ reached getOption("max.print") -- omitted 15040 rows ]
> ##divide each value by its corresponding pseudo-reference value
> pseudo_ref_ratios <- counts(bacteria.ps.dataset.norm.deseq) %>% apply(., 2, function(cts){ cts/geoMeans})
> ## if you want to see what that means at the single-gene level,
> ## compare the result of this:
> counts(bacteria.ps.dataset.norm.deseq)[1,]/geoMeans[1]
 16S-BLANCO1  16S-BLANCO2 16S-MEC-01-1 16S-MEC-01-2 16S-MEC-02-1 16S-MEC-02-2 16S-MEC-03-1 16S-MEC-03-2 
   0.0000000    0.6591146    0.9621558    1.6818786    2.7008547    1.5530861    1.7993071    3.5152779 
16S-MEC-04-1 16S-MEC-04-2 16S-MEC-05-1 16S-MEC-05-2 16S-MEC-06-1 16S-MEC-07-1 16S-MEC-07-2 16S-MEC-08-1 
   2.2728090    1.3258052    3.3069371    2.8751034    1.2045888    1.3636854    0.6250225    2.0417401 
16S-MEC-08-2 16S-MEC-09-1 16S-MEC-09-2 16S-MEC-10-1 16S-MEC-10-2 16S-MPS-01-1 16S-MPS-01-2 16S-MPS-02-1 
   0.4128936    3.2690569    4.0190839    2.5152419    2.2841730    0.7879071    1.0151880    1.1894367 
16S-MPS-02-2 16S-MPS-03-1 16S-MPS-03-2 16S-MPS-04-1 16S-MPS-04-2 16S-MPS-05-1 16S-MPS-05-2 16S-MPS-06-1 
   2.1326524    0.7500270    0.1894007    0.3939536    0.4545618    2.1970487    0.7310869    0.4772899 
16S-MPS-06-2 16S-MPS-07-1 16S-MPS-07-2 16S-MPS-08-2 16S-MPS-21-1 16S-MPS-21-2 16S-MPS-29-1 16S-MPS-29-2 
   0.8409393    0.0000000    0.4697139    4.8069910    2.1553805    1.0795843    0.0000000    4.7994150 
16S-MSF-07-1 16S-MSF-07-2 16S-MSF-08-1 16S-MSF-08-2 16S-MSF-09-1 16S-MSF-09-2 16S-MSF-10-1 16S-MSF-10-2 
   1.8750674    0.8901835    0.5682022    0.6098704    1.3371693    1.3333813    4.7539588    3.3561813 
16S-MSF-11-1 16S-MSF-11-2 16S-MSF-17-1 16S-MSF-17-2 16S-MSF-18-1 16S-MSF-18-2 16S-MSF-19-2 16S-MSF-21-1 
   1.8106712    2.4243296    3.3334532    4.0115079    2.2122007    1.8068831    3.4243655    0.9545798 
16S-MSF-21-2 16S-MSF-22-1 16S-MSF-22-2 16S-OEC-01-1 16S-OEC-01-2 16S-OEC-02-1 16S-OEC-02-2 16S-OEC-03-1 
   0.6098704    0.9242757    1.3068652    4.9130554    4.3372771    2.7160067    2.4053895    5.7767228 
16S-OEC-03-2 16S-OEC-04-1 16S-OEC-04-2 16S-OEC-05-1 16S-OEC-05-2 16S-OEC-06-1 16S-OEC-06-2 16S-OEC-07-1 
   7.0570719    7.2010165    6.6441783    1.9735558    1.0114000    2.4508457    2.3788734    2.6857026 
16S-OEC-07-2 16S-OEC-08-1 16S-OEC-08-2 16S-OEC-09-1 16S-OEC-09-2 16S-OEC-10-1 16S-OEC-10-2 16S-OPS-01-1 
   3.1440524    2.9319236    2.2387168    1.2500449    3.1023843    2.6591865    1.6023303    1.0795843 
16S-OPS-01-2 16S-OPS-02-1 16S-OPS-02-2 16S-OPS-03-1 16S-OPS-03-2 16S-OPS-04-1 16S-OPS-04-2 16S-OPS-05-1 
   0.4659258    0.9962479    1.6402105    0.6629026    0.6060824    0.0000000    0.9924599    0.0000000 
16S-OPS-05-2 16S-OPS-06-1 16S-OPS-06-2 16S-OPS-07-1 16S-OPS-07-2 16S-OPS-08-1 16S-OPS-08-2 16S-OPS-21-1 
   0.3409213    0.6401745    0.3939536    0.0000000    1.9508277    1.9318876    0.4621378    1.6402105 
16S-OPS-29-1 16S-OPS-29-2 16S-OSF-07-1 16S-OSF-07-2 16S-OSF-08-1 16S-OSF-08-2 16S-OSF-09-1 16S-OSF-09-2 
   0.5341101    0.5719903    3.7652869    4.4547056    0.3522854    3.1478404    0.0000000    0.0000000 
16S-OSF-10-1 16S-OSF-10-2 16S-OSF-11-1 16S-OSF-11-2 16S-OSF-17-1 16S-OSF-17-2 16S-OSF-18-1 16S-OSF-18-2 
   1.6591506    1.7197588    0.2462210    0.5644142    2.7349468    2.8447992    3.3561813    0.3598614 
16S-OSF-19-1 16S-OSF-19-2 16S-OSF-21-1 16S-OSF-21-2 16S-OSF-22-1 16S-OSF-22-2 
   2.0000719    3.0076839    3.0796562    0.9773079    0.9697318    0.6591146 
> ## With
> pseudo_ref_ratios[1,]
 16S-BLANCO1  16S-BLANCO2 16S-MEC-01-1 16S-MEC-01-2 16S-MEC-02-1 16S-MEC-02-2 16S-MEC-03-1 16S-MEC-03-2 
   0.0000000    0.6591146    0.9621558    1.6818786    2.7008547    1.5530861    1.7993071    3.5152779 
16S-MEC-04-1 16S-MEC-04-2 16S-MEC-05-1 16S-MEC-05-2 16S-MEC-06-1 16S-MEC-07-1 16S-MEC-07-2 16S-MEC-08-1 
   2.2728090    1.3258052    3.3069371    2.8751034    1.2045888    1.3636854    0.6250225    2.0417401 
16S-MEC-08-2 16S-MEC-09-1 16S-MEC-09-2 16S-MEC-10-1 16S-MEC-10-2 16S-MPS-01-1 16S-MPS-01-2 16S-MPS-02-1 
   0.4128936    3.2690569    4.0190839    2.5152419    2.2841730    0.7879071    1.0151880    1.1894367 
16S-MPS-02-2 16S-MPS-03-1 16S-MPS-03-2 16S-MPS-04-1 16S-MPS-04-2 16S-MPS-05-1 16S-MPS-05-2 16S-MPS-06-1 
   2.1326524    0.7500270    0.1894007    0.3939536    0.4545618    2.1970487    0.7310869    0.4772899 
16S-MPS-06-2 16S-MPS-07-1 16S-MPS-07-2 16S-MPS-08-2 16S-MPS-21-1 16S-MPS-21-2 16S-MPS-29-1 16S-MPS-29-2 
   0.8409393    0.0000000    0.4697139    4.8069910    2.1553805    1.0795843    0.0000000    4.7994150 
16S-MSF-07-1 16S-MSF-07-2 16S-MSF-08-1 16S-MSF-08-2 16S-MSF-09-1 16S-MSF-09-2 16S-MSF-10-1 16S-MSF-10-2 
   1.8750674    0.8901835    0.5682022    0.6098704    1.3371693    1.3333813    4.7539588    3.3561813 
16S-MSF-11-1 16S-MSF-11-2 16S-MSF-17-1 16S-MSF-17-2 16S-MSF-18-1 16S-MSF-18-2 16S-MSF-19-2 16S-MSF-21-1 
   1.8106712    2.4243296    3.3334532    4.0115079    2.2122007    1.8068831    3.4243655    0.9545798 
16S-MSF-21-2 16S-MSF-22-1 16S-MSF-22-2 16S-OEC-01-1 16S-OEC-01-2 16S-OEC-02-1 16S-OEC-02-2 16S-OEC-03-1 
   0.6098704    0.9242757    1.3068652    4.9130554    4.3372771    2.7160067    2.4053895    5.7767228 
16S-OEC-03-2 16S-OEC-04-1 16S-OEC-04-2 16S-OEC-05-1 16S-OEC-05-2 16S-OEC-06-1 16S-OEC-06-2 16S-OEC-07-1 
   7.0570719    7.2010165    6.6441783    1.9735558    1.0114000    2.4508457    2.3788734    2.6857026 
16S-OEC-07-2 16S-OEC-08-1 16S-OEC-08-2 16S-OEC-09-1 16S-OEC-09-2 16S-OEC-10-1 16S-OEC-10-2 16S-OPS-01-1 
   3.1440524    2.9319236    2.2387168    1.2500449    3.1023843    2.6591865    1.6023303    1.0795843 
16S-OPS-01-2 16S-OPS-02-1 16S-OPS-02-2 16S-OPS-03-1 16S-OPS-03-2 16S-OPS-04-1 16S-OPS-04-2 16S-OPS-05-1 
   0.4659258    0.9962479    1.6402105    0.6629026    0.6060824    0.0000000    0.9924599    0.0000000 
16S-OPS-05-2 16S-OPS-06-1 16S-OPS-06-2 16S-OPS-07-1 16S-OPS-07-2 16S-OPS-08-1 16S-OPS-08-2 16S-OPS-21-1 
   0.3409213    0.6401745    0.3939536    0.0000000    1.9508277    1.9318876    0.4621378    1.6402105 
16S-OPS-29-1 16S-OPS-29-2 16S-OSF-07-1 16S-OSF-07-2 16S-OSF-08-1 16S-OSF-08-2 16S-OSF-09-1 16S-OSF-09-2 
   0.5341101    0.5719903    3.7652869    4.4547056    0.3522854    3.1478404    0.0000000    0.0000000 
16S-OSF-10-1 16S-OSF-10-2 16S-OSF-11-1 16S-OSF-11-2 16S-OSF-17-1 16S-OSF-17-2 16S-OSF-18-1 16S-OSF-18-2 
   1.6591506    1.7197588    0.2462210    0.5644142    2.7349468    2.8447992    3.3561813    0.3598614 
16S-OSF-19-1 16S-OSF-19-2 16S-OSF-21-1 16S-OSF-21-2 16S-OSF-22-1 16S-OSF-22-2 
   2.0000719    3.0076839    3.0796562    0.9773079    0.9697318    0.6591146 
> ## determine the median value per sample to get the size factor
> apply(pseudo_ref_ratios, 2, median)
 16S-BLANCO1  16S-BLANCO2 16S-MEC-01-1 16S-MEC-01-2 16S-MEC-02-1 16S-MEC-02-2 16S-MEC-03-1 16S-MEC-03-2 
           0            0            0            0            0            0            0            0 
16S-MEC-04-1 16S-MEC-04-2 16S-MEC-05-1 16S-MEC-05-2 16S-MEC-06-1 16S-MEC-07-1 16S-MEC-07-2 16S-MEC-08-1 
           0            0            0            0            0            0            0            0 
16S-MEC-08-2 16S-MEC-09-1 16S-MEC-09-2 16S-MEC-10-1 16S-MEC-10-2 16S-MPS-01-1 16S-MPS-01-2 16S-MPS-02-1 
           0            0            0            0            0            0            0            0 
16S-MPS-02-2 16S-MPS-03-1 16S-MPS-03-2 16S-MPS-04-1 16S-MPS-04-2 16S-MPS-05-1 16S-MPS-05-2 16S-MPS-06-1 
           0            0            0            0            0            0            0            0 
16S-MPS-06-2 16S-MPS-07-1 16S-MPS-07-2 16S-MPS-08-2 16S-MPS-21-1 16S-MPS-21-2 16S-MPS-29-1 16S-MPS-29-2 
           0            0            0            0            0            0            0            0 
16S-MSF-07-1 16S-MSF-07-2 16S-MSF-08-1 16S-MSF-08-2 16S-MSF-09-1 16S-MSF-09-2 16S-MSF-10-1 16S-MSF-10-2 
           0            0            0            0            0            0            0            0 
16S-MSF-11-1 16S-MSF-11-2 16S-MSF-17-1 16S-MSF-17-2 16S-MSF-18-1 16S-MSF-18-2 16S-MSF-19-2 16S-MSF-21-1 
           0            0            0            0            0            0            0            0 
16S-MSF-21-2 16S-MSF-22-1 16S-MSF-22-2 16S-OEC-01-1 16S-OEC-01-2 16S-OEC-02-1 16S-OEC-02-2 16S-OEC-03-1 
           0            0            0            0            0            0            0            0 
16S-OEC-03-2 16S-OEC-04-1 16S-OEC-04-2 16S-OEC-05-1 16S-OEC-05-2 16S-OEC-06-1 16S-OEC-06-2 16S-OEC-07-1 
           0            0            0            0            0            0            0            0 
16S-OEC-07-2 16S-OEC-08-1 16S-OEC-08-2 16S-OEC-09-1 16S-OEC-09-2 16S-OEC-10-1 16S-OEC-10-2 16S-OPS-01-1 
           0            0            0            0            0            0            0            0 
16S-OPS-01-2 16S-OPS-02-1 16S-OPS-02-2 16S-OPS-03-1 16S-OPS-03-2 16S-OPS-04-1 16S-OPS-04-2 16S-OPS-05-1 
           0            0            0            0            0            0            0            0 
16S-OPS-05-2 16S-OPS-06-1 16S-OPS-06-2 16S-OPS-07-1 16S-OPS-07-2 16S-OPS-08-1 16S-OPS-08-2 16S-OPS-21-1 
           0            0            0            0            0            0            0            0 
16S-OPS-29-1 16S-OPS-29-2 16S-OSF-07-1 16S-OSF-07-2 16S-OSF-08-1 16S-OSF-08-2 16S-OSF-09-1 16S-OSF-09-2 
           0            0            0            0            0            0            0            0 
16S-OSF-10-1 16S-OSF-10-2 16S-OSF-11-1 16S-OSF-11-2 16S-OSF-17-1 16S-OSF-17-2 16S-OSF-18-1 16S-OSF-18-2 
           0            0            0            0            0            0            0            0 
16S-OSF-19-1 16S-OSF-19-2 16S-OSF-21-1 16S-OSF-21-2 16S-OSF-22-1 16S-OSF-22-2 
           0            0            0            0            0            0 
> bacteria.ps.dataset.norm.deseq = estimateSizeFactors(bacteria.ps.dataset.norm.deseq, geoMeans = geoMeans) # calculate SFs, add them to object
  Note: levels of factors in the design contain characters other than
  letters, numbers, '_' and '.'. It is recommended (but not required) to use
  only letters, numbers, and delimiters '_' or '.', as these are safe characters
  for column names in R. [This is a message, not a warning or an error]
> plot(sizeFactors(bacteria.ps.dataset.norm.deseq), colSums(counts(bacteria.ps.dataset.norm.deseq)), # asses the
+      ylab = "library sizes", xlab = "size factors", cex = .6)
> counts(bacteria.ps.dataset.norm.deseq)
         16S-BLANCO1 16S-BLANCO2 16S-MEC-01-1 16S-MEC-01-2 16S-MEC-02-1 16S-MEC-02-2 16S-MEC-03-1
ASV1               0         174          254          444          713          410          475
ASV2               0          41           61           63          142          173           30
ASV3               0         191          112          168          249          237          356
ASV4               0         201           85          115          173          115           28
ASV5               0         257           95          128          187           83           37
ASV6               0           0            0            0            0          154            0
ASV7               0           0           86           67          139          251          171
ASV8               0          40          161          206           90           50            0
         16S-MEC-03-2 16S-MEC-04-1 16S-MEC-04-2 16S-MEC-05-1 16S-MEC-05-2 16S-MEC-06-1 16S-MEC-07-1
ASV1              928          600          350          873          759          318          360
ASV2              155          866            0          298          206            0          306
ASV3              827           54          289          264           94          299          223
ASV4              292           75           81          769          488           59          286
ASV5              303            0          116          174          131           48           68
ASV6               71          535          193            0            0          113            0
ASV7              760          146          107           39          109          180          144
ASV8               81           32          416            0          161           77           65
         16S-MEC-07-2 16S-MEC-08-1 16S-MEC-08-2 16S-MEC-09-1 16S-MEC-09-2 16S-MEC-10-1 16S-MEC-10-2
ASV1              165          539          109          863         1061          664          603
ASV2              111          784           33          204          116          174          110
ASV3                0           57            0          170          251           81           54
ASV4              157          145          112          401          227           95          125
ASV5               30            0           47          194          173          216          208
ASV6                0          402            0          134          157          271          190
ASV7               43          174            0          237          140           69           44
ASV8               43           83          160          422          535          321          269
         16S-MPS-01-1 16S-MPS-01-2 16S-MPS-02-1 16S-MPS-02-2 16S-MPS-03-1 16S-MPS-03-2 16S-MPS-04-1
ASV1              208          268          314          563          198           50          104
ASV2               28           54          419          287           47           31          158
ASV3               89          301           93          230          154           88          119
ASV4               69          385          401          200           55          167          308
ASV5              216          207          341          312          123          111          259
ASV6                0          138          333          187            0          157            0
ASV7                0          110           47          134           20            0           32
ASV8              271           57          151          369          165          133           85
         16S-MPS-04-2 16S-MPS-05-1 16S-MPS-05-2 16S-MPS-06-1 16S-MPS-06-2 16S-MPS-07-1 16S-MPS-07-2
ASV1              120          580          193          126          222            0          124
ASV2              108          106           45           48          339          400           51
ASV3              102          744          511          216           82            0            0
ASV4              301          815          123          123          528          335          459
ASV5              198          478          399          452          295          262          226
ASV6                0          294           96            0          645            0            0
ASV7                0          518           68            0          209            0           15
ASV8               91           92          254          139           43           75          181
         16S-MPS-08-2 16S-MPS-21-1 16S-MPS-21-2 16S-MPS-29-1 16S-MPS-29-2 16S-MSF-07-1 16S-MSF-07-2
ASV1             1269          569          285            0         1267          495          235
ASV2              725          161           53          668          109           56           56
ASV3              942            0            0            0          341           89           71
ASV4             1024          604          321          369          312          147           42
ASV5              574           67           84          399          299           39            0
ASV6              337          150            0          195           40            0            0
ASV7             2078            5            0           72          138           68           75
ASV8              602          274          199           86          310          225          221
         16S-MSF-08-1 16S-MSF-08-2 16S-MSF-09-1 16S-MSF-09-2 16S-MSF-10-1 16S-MSF-10-2 16S-MSF-11-1
ASV1              150          161          353          352         1255          886          478
ASV2               42          127           80           49          283           92          620
ASV3              335          387          198          183          251          253          383
ASV4               40           59          275           34          174           60            6
ASV5              200          134          227           45          305          256            0
ASV6                0          138          262            0          450          298          876
ASV7               35          174          106          131          525          577         1729
ASV8              101          109           39          155          400          433            0
         16S-MSF-11-2 16S-MSF-17-1 16S-MSF-17-2 16S-MSF-18-1 16S-MSF-18-2 16S-MSF-19-2 16S-MSF-21-1
ASV1              640          880         1059          584          477          904          252
ASV2              666          141          282          235          173          969          786
ASV3              327          220          266          138          221          285          474
ASV4               58           47          140          255          154          371           24
ASV5               42          110          349          116          118          192            0
ASV6              771          113          132          171          134          508          775
ASV7              577          405          509          154          301          579          381
ASV8               64          377          276          173          201           71           43
         16S-MSF-21-2 16S-MSF-22-1 16S-MSF-22-2 16S-OEC-01-1 16S-OEC-01-2 16S-OEC-02-1 16S-OEC-02-2
ASV1              161          244          345         1297         1145          717          635
ASV2              258           48          268          218          197          202          118
ASV3              217          159          227          449          485          351           72
ASV4                0           94           98          169          139          122           65
ASV5                0          264          382          222          299           94           94
ASV6              427          112          208          143            0          239            0
ASV7              222            0          400           53           54          321           59
ASV8               60          395          354          168           79          576          520
         16S-OEC-03-1 16S-OEC-03-2 16S-OEC-04-1 16S-OEC-04-2 16S-OEC-05-1 16S-OEC-05-2 16S-OEC-06-1
ASV1             1525         1863         1901         1754          521          267          647
ASV2              322          547          208          377          129           51          123
ASV3              439          221          116          300          173          183          254
ASV4              176          388          100          184           25           26           75
ASV5              210          271          181          314           81           76          110
ASV6              194          298            0            0            0            0           86
ASV7              193          124           33           90           89           87           79
ASV8              168          159          129          219          242          143          192
         16S-OEC-06-2 16S-OEC-07-1 16S-OEC-07-2 16S-OEC-08-1 16S-OEC-08-2 16S-OEC-09-1 16S-OEC-09-2
ASV1              628          709          830          774          591          330          819
ASV2              150          130          101          209          111           68          195
ASV3              240          162          178          483          445          151          187
ASV4              128          368          125          121          134           32          397
ASV5              141           62          176          129           48           29          145
ASV6               96          137          110            0            0            0          138
ASV7              139           36           49           70           50           56           42
ASV8              141           85          271           72            0          145          188
         16S-OEC-10-1 16S-OEC-10-2 16S-OPS-01-1 16S-OPS-01-2 16S-OPS-02-1 16S-OPS-02-2 16S-OPS-03-1
ASV1              702          423          285          123          263          433          175
ASV2              132           66          124           41           62          133           57
ASV3              183          169          191           59          194          185           80
ASV4              162           61          515          226           27          253          180
ASV5              198           82          560          284          156          236          143
ASV6              138            0          321          110            0          204          135
ASV7               65            0           61            0           35            0            0
ASV8              315          229          181            0          176          159           54
         16S-OPS-03-2 16S-OPS-04-1 16S-OPS-04-2 16S-OPS-05-1 16S-OPS-05-2 16S-OPS-06-1 16S-OPS-06-2
ASV1              160            0          262            0           90          169          104
ASV2               61           24           39            0            0          433          358
ASV3              108            0          118          276          420           82           69
ASV4              103           28           14            0           39          767          519
ASV5              172            0           72           78          232          623          478
ASV6              163            0            0            0          139          414          284
ASV7                0            0           28          169          122          213          111
ASV8              150            0          134           25           34          119           80
         16S-OPS-07-1 16S-OPS-07-2 16S-OPS-08-1 16S-OPS-08-2 16S-OPS-21-1 16S-OPS-29-1 16S-OPS-29-2
ASV1                0          515          510          122          433          141          151
ASV2             1754          155          775         1088          808           28          778
ASV3               74          474          161            0          278            0          471
ASV4              855           11          815          342          846          115          220
ASV5              581          299          295          620          371           71          578
ASV6             1763            0          327         1681          360            0          443
ASV7              384           50          211          340          116            0          486
ASV8               26          673          215            0          357          100          106
         16S-OSF-07-1 16S-OSF-07-2 16S-OSF-08-1 16S-OSF-08-2 16S-OSF-09-1 16S-OSF-09-2 16S-OSF-10-1
ASV1              994         1176           93          831            0            0          438
ASV2              122          168            0          205          143            0          189
ASV3              173          285          131          315            0            0          184
ASV4               47           77           52          103          145           33          282
ASV5              151          170          100          233           26            0          331
ASV6                0           93            0          642            0            0          187
ASV7               33           84          100          514            0            0           81
ASV8              161          162           18          244            0            0          151
         16S-OSF-10-2 16S-OSF-11-1 16S-OSF-11-2 16S-OSF-17-1 16S-OSF-17-2 16S-OSF-18-1 16S-OSF-18-2
ASV1              454           65          149          722          751          886           95
ASV2              388            0           31          225          146          319           53
ASV3              548           79          469          686          517          196          218
ASV4               21          104           37           93           72          102           48
ASV5              170          155          299          159          218          170          134
ASV6              977           38            0          128            0          388            0
ASV7              748           11          125          254          216          269           30
ASV8              220           30           79          424          252          395           57
         16S-OSF-19-1 16S-OSF-19-2 16S-OSF-21-1 16S-OSF-21-2 16S-OSF-22-1 16S-OSF-22-2
ASV1              528          794          813          258          256          174
ASV2              237          241         1433          160           75          220
ASV3              248          443          446          435           96          156
ASV4               55          141            0           94          114          308
ASV5               98          229           95          282           72          335
ASV6              415          335          909            0            0          221
ASV7              118          308          363          393           32           94
ASV8              236          272           54          333          221           14
 [ reached getOption("max.print") -- omitted 15040 rows ]
> bacteria.ps.dataset.norm.deseq <- estimateDispersions(bacteria.ps.dataset.norm.deseq, fitType = "mean")
gene-wise dispersion estimates
mean-dispersion relationship
  Note: levels of factors in the design contain characters other than
  letters, numbers, '_' and '.'. It is recommended (but not required) to use
  only letters, numbers, and delimiters '_' or '.', as these are safe characters
  for column names in R. [This is a message, not a warning or an error]
final dispersion estimates
> bacteria.ps.dataset.norm.desq.var <- DESeq2::getVarianceStabilizedData(bacteria.ps.dataset.norm.deseq)
> View(bacteria.ps.dataset.norm.desq.var)
> ## extracting normalized counts
> normalized_counts <- counts(bacteria.ps.dataset.norm.deseq, normalized=TRUE)
> normalized_counts = round(normalized_counts, 0)
> head(normalized_counts)
     16S-BLANCO1 16S-BLANCO2 16S-MEC-01-1 16S-MEC-01-2 16S-MEC-02-1 16S-MEC-02-2 16S-MEC-03-1 16S-MEC-03-2
ASV1           0         168          376          446          811          477          351          605
ASV2           0          40           90           63          162          201           22          101
ASV3           0         185          166          169          283          276          263          539
ASV4           0         194          126          115          197          134           21          190
ASV5           0         248          141          129          213           97           27          198
ASV6           0           0            0            0            0          179            0           46
     16S-MEC-04-1 16S-MEC-04-2 16S-MEC-05-1 16S-MEC-05-2 16S-MEC-06-1 16S-MEC-07-1 16S-MEC-07-2 16S-MEC-08-1
ASV1          717          229          905          900          325          353          202          575
ASV2         1035            0          309          244            0          300          136          836
ASV3           65          189          274          111          306          219            0           61
ASV4           90           53          797          579           60          280          192          155
ASV5            0           76          180          155           49           67           37            0
ASV6          640          126            0            0          116            0            0          429
     16S-MEC-08-2 16S-MEC-09-1 16S-MEC-09-2 16S-MEC-10-1 16S-MEC-10-2 16S-MPS-01-1 16S-MPS-01-2 16S-MPS-02-1
ASV1           84         1135         1320          689          858          203          232          301
ASV2           25          268          144          180          156           27           47          402
ASV3            0          224          312           84           77           87          260           89
ASV4           86          527          282           99          178           67          333          384
ASV5           36          255          215          224          296          211          179          327
ASV6            0          176          195          281          270            0          119          319
     16S-MPS-02-2 16S-MPS-03-1 16S-MPS-03-2 16S-MPS-04-1 16S-MPS-04-2 16S-MPS-05-1 16S-MPS-05-2 16S-MPS-06-1
ASV1          643          245          101          106          141          388          135          110
ASV2          328           58           62          161          127           71           32           42
ASV3          263          191          177          122          120          497          358          189
ASV4          228           68          336          315          354          545           86          108
ASV5          356          152          223          265          233          319          280          396
ASV6          214            0          316            0            0          196           67            0
     16S-MPS-06-2 16S-MPS-07-1 16S-MPS-07-2 16S-MPS-08-2 16S-MPS-21-1 16S-MPS-21-2 16S-MPS-29-1 16S-MPS-29-2
ASV1          222            0           72          905          416          197            0          960
ASV2          340          243           30          517          118           37          436           83
ASV3           82            0            0          671            0            0            0          258
ASV4          529          203          268          730          442          222          241          236
ASV5          296          159          132          409           49           58          260          226
ASV6          646            0            0          240          110            0          127           30
     16S-MSF-07-1 16S-MSF-07-2 16S-MSF-08-1 16S-MSF-08-2 16S-MSF-09-1 16S-MSF-09-2 16S-MSF-10-1 16S-MSF-10-2
ASV1          546          259          141          191          351          746         1442         1042
ASV2           62           62           39          151           80          104          325          108
ASV3           98           78          314          459          197          388          288          298
ASV4          162           46           37           70          274           72          200           71
ASV5           43            0          187          159          226           95          350          301
ASV6            0            0            0          164          261            0          517          350
     16S-MSF-11-1 16S-MSF-11-2 16S-MSF-17-1 16S-MSF-17-2 16S-MSF-18-1 16S-MSF-18-2 16S-MSF-19-2 16S-MSF-21-1
ASV1          407          859         1250         1228          891          757          939          282
ASV2          528          894          200          327          359          275         1007          880
ASV3          326          439          313          308          211          351          296          531
ASV4            5           78           67          162          389          244          385           27
ASV5            0           56          156          405          177          187          199            0
ASV6          747         1035          161          153          261          213          528          868
     16S-MSF-21-2 16S-MSF-22-1 16S-MSF-22-2 16S-OEC-01-1 16S-OEC-01-2 16S-OEC-02-1 16S-OEC-02-2 16S-OEC-03-1
ASV1          229          193          437         1286         1089          751          847         1683
ASV2          367           38          339          216          187          211          157          355
ASV3          308          126          287          445          461          367           96          485
ASV4            0           74          124          168          132          128           87          194
ASV5            0          209          483          220          284           98          125          232
ASV6          607           89          263          142            0          250            0          214
     16S-OEC-03-2 16S-OEC-04-1 16S-OEC-04-2 16S-OEC-05-1 16S-OEC-05-2 16S-OEC-06-1 16S-OEC-06-2 16S-OEC-07-1
ASV1         2450         1945         1679          478          259          676          693          952
ASV2          719          213          361          118           49          128          166          175
ASV3          291          119          287          159          177          265          265          218
ASV4          510          102          176           23           25           78          141          494
ASV5          356          185          301           74           74          115          156           83
ASV6          392            0            0            0            0           90          106          184
     16S-OEC-07-2 16S-OEC-08-1 16S-OEC-08-2 16S-OEC-09-1 16S-OEC-09-2 16S-OEC-10-1 16S-OEC-10-2 16S-OPS-01-1
ASV1         1042          605          503          275          990          710          475          294
ASV2          127          163           94           57          236          134           74          128
ASV3          224          377          379          126          226          185          190          197
ASV4          157           95          114           27          480          164           68          531
ASV5          221          101           41           24          175          200           92          578
ASV6          138            0            0            0          167          140            0          331
     16S-OPS-01-2 16S-OPS-02-1 16S-OPS-02-2 16S-OPS-03-1 16S-OPS-03-2 16S-OPS-04-1 16S-OPS-04-2 16S-OPS-05-1
ASV1          169          269          289          187          165            0          241            0
ASV2           56           63           89           61           63           52           36            0
ASV3           81          199          123           85          111            0          109          213
ASV4          311           28          169          192          106           61           13            0
ASV5          391          160          158          153          177            0           66           60
ASV6          151            0          136          144          168            0            0            0
     16S-OPS-05-2 16S-OPS-06-1 16S-OPS-06-2 16S-OPS-07-1 16S-OPS-07-2 16S-OPS-08-1 16S-OPS-08-2 16S-OPS-21-1
ASV1           59          136           93            0          321          377           50          346
ASV2            0          350          320          813           97          572          447          646
ASV3          277           66           62           34          296          119            0          222
ASV4           26          619          465          396            7          602          140          676
ASV5          153          503          428          269          187          218          255          297
ASV6           92          334          254          817            0          241          690          288
     16S-OPS-29-1 16S-OPS-29-2 16S-OSF-07-1 16S-OSF-07-2 16S-OSF-08-1 16S-OSF-08-2 16S-OSF-09-1 16S-OSF-09-2
ASV1          121           98         1563         1435          147          965            0            0
ASV2           24          507          192          205            0          238          129            0
ASV3            0          307          272          348          207          366            0            0
ASV4           99          143           74           94           82          120          130           33
ASV5           61          377          237          207          158          271           23            0
ASV6            0          289            0          114            0          746            0            0
     16S-OSF-10-1 16S-OSF-10-2 16S-OSF-11-1 16S-OSF-11-2 16S-OSF-17-1 16S-OSF-17-2 16S-OSF-18-1 16S-OSF-18-2
ASV1          644          367           89          111          797          880         1183          105
ASV2          278          314            0           23          248          171          426           58
ASV3          270          443          109          348          757          606          262          240
ASV4          414           17          143           27          103           84          136           53
ASV5          486          137          213          222          176          256          227          148
ASV6          275          790           52            0          141            0          518            0
     16S-OSF-19-1 16S-OSF-19-2 16S-OSF-21-1 16S-OSF-21-2 16S-OSF-22-1 16S-OSF-22-2
ASV1          869         1008          485          310          289          213
ASV2          390          306          854          192           85          270
ASV3          408          563          266          522          108          191
ASV4           91          179            0          113          129          377
ASV5          161          291           57          339           81          411
ASV6          683          425          542            0            0          271
> ## adding the boxplots
> boxplot(normalized_counts, main = "SF normalized", cex = .6)
> boxplot(counts(bacteria.ps.dataset.norm.deseq), main = "read counts only", cex = .6)
> par(mfrow=c(1,2)) #to plot the two box plots next to each other
> ##bp of non-normalized
> boxplot(log2(counts(bacteria.ps.dataset.norm.deseq)+1), notch=TRUE,
+         main = "Non-normalized read counts",
+         ylab="log2(read counts)", cex = 0.6)
> ## bp of size-factor normalized values
> boxplot(log2(counts(bacteria.ps.dataset.norm.deseq, normalize=TRUE) +1), notch=TRUE,
+         main = "Size-factor-normalized read counts",
+         ylab="log2(read counts)", cex = 0.6)
> class(normalized_counts)
[1] "matrix" "array" 
> otu_table(bacteria.ps.dataset.norm) <- otu_table(normalized_counts, taxa_are_rows = TRUE)
> head(otu_table(bacteria.ps.dataset.norm), 10)
OTU Table:          [10 taxa and 118 samples]
                     taxa are rows
      16S-BLANCO1 16S-BLANCO2 16S-MEC-01-1 16S-MEC-01-2 16S-MEC-02-1 16S-MEC-02-2 16S-MEC-03-1 16S-MEC-03-2
ASV1            0         168          376          446          811          477          351          605
ASV2            0          40           90           63          162          201           22          101
ASV3            0         185          166          169          283          276          263          539
ASV4            0         194          126          115          197          134           21          190
ASV5            0         248          141          129          213           97           27          198
ASV6            0           0            0            0            0          179            0           46
ASV7            0           0          127           67          158          292          126          496
ASV8            0          39          239          207          102           58            0           53
      16S-MEC-04-1 16S-MEC-04-2 16S-MEC-05-1 16S-MEC-05-2 16S-MEC-06-1 16S-MEC-07-1 16S-MEC-07-2 16S-MEC-08-1
ASV1           717          229          905          900          325          353          202          575
ASV2          1035            0          309          244            0          300          136          836
ASV3            65          189          274          111          306          219            0           61
ASV4            90           53          797          579           60          280          192          155
ASV5             0           76          180          155           49           67           37            0
ASV6           640          126            0            0          116            0            0          429
ASV7           175           70           40          129          184          141           53          185
ASV8            38          273            0          191           79           64           53           88
      16S-MEC-08-2 16S-MEC-09-1 16S-MEC-09-2 16S-MEC-10-1 16S-MEC-10-2 16S-MPS-01-1 16S-MPS-01-2 16S-MPS-02-1
ASV1            84         1135         1320          689          858          203          232          301
ASV2            25          268          144          180          156           27           47          402
ASV3             0          224          312           84           77           87          260           89
ASV4            86          527          282           99          178           67          333          384
ASV5            36          255          215          224          296          211          179          327
ASV6             0          176          195          281          270            0          119          319
ASV7             0          312          174           72           63            0           95           45
ASV8           123          555          665          333          383          264           49          145
      16S-MPS-02-2 16S-MPS-03-1 16S-MPS-03-2 16S-MPS-04-1 16S-MPS-04-2 16S-MPS-05-1 16S-MPS-05-2 16S-MPS-06-1
ASV1           643          245          101          106          141          388          135          110
ASV2           328           58           62          161          127           71           32           42
ASV3           263          191          177          122          120          497          358          189
ASV4           228           68          336          315          354          545           86          108
ASV5           356          152          223          265          233          319          280          396
ASV6           214            0          316            0            0          196           67            0
ASV7           153           25            0           33            0          346           48            0
ASV8           421          205          267           87          107           61          178          122
      16S-MPS-06-2 16S-MPS-07-1 16S-MPS-07-2 16S-MPS-08-2 16S-MPS-21-1 16S-MPS-21-2 16S-MPS-29-1 16S-MPS-29-2
ASV1           222            0           72          905          416          197            0          960
ASV2           340          243           30          517          118           37          436           83
ASV3            82            0            0          671            0            0            0          258
ASV4           529          203          268          730          442          222          241          236
ASV5           296          159          132          409           49           58          260          226
ASV6           646            0            0          240          110            0          127           30
ASV7           209            0            9         1481            4            0           47          105
ASV8            43           46          106          429          201          138           56          235
      16S-MSF-07-1 16S-MSF-07-2 16S-MSF-08-1 16S-MSF-08-2 16S-MSF-09-1 16S-MSF-09-2 16S-MSF-10-1 16S-MSF-10-2
ASV1           546          259          141          191          351          746         1442         1042
ASV2            62           62           39          151           80          104          325          108
ASV3            98           78          314          459          197          388          288          298
ASV4           162           46           37           70          274           72          200           71
ASV5            43            0          187          159          226           95          350          301
ASV6             0            0            0          164          261            0          517          350
ASV7            75           83           33          207          106          278          603          678
ASV8           248          244           95          129           39          329          459          509
      16S-MSF-11-1 16S-MSF-11-2 16S-MSF-17-1 16S-MSF-17-2 16S-MSF-18-1 16S-MSF-18-2 16S-MSF-19-2 16S-MSF-21-1
ASV1           407          859         1250         1228          891          757          939          282
ASV2           528          894          200          327          359          275         1007          880
ASV3           326          439          313          308          211          351          296          531
ASV4             5           78           67          162          389          244          385           27
ASV5             0           56          156          405          177          187          199            0
ASV6           747         1035          161          153          261          213          528          868
ASV7          1474          774          575          590          235          478          601          427
ASV8             0           86          536          320          264          319           74           48
      16S-MSF-21-2 16S-MSF-22-1 16S-MSF-22-2 16S-OEC-01-1 16S-OEC-01-2 16S-OEC-02-1 16S-OEC-02-2 16S-OEC-03-1
ASV1           229          193          437         1286         1089          751          847         1683
ASV2           367           38          339          216          187          211          157          355
ASV3           308          126          287          445          461          367           96          485
ASV4             0           74          124          168          132          128           87          194
ASV5             0          209          483          220          284           98          125          232
ASV6           607           89          263          142            0          250            0          214
ASV7           316            0          506           53           51          336           79          213
ASV8            85          312          448          167           75          603          694          185
      16S-OEC-03-2 16S-OEC-04-1 16S-OEC-04-2 16S-OEC-05-1 16S-OEC-05-2 16S-OEC-06-1 16S-OEC-06-2 16S-OEC-07-1
ASV1          2450         1945         1679          478          259          676          693          952
ASV2           719          213          361          118           49          128          166          175
ASV3           291          119          287          159          177          265          265          218
ASV4           510          102          176           23           25           78          141          494
ASV5           356          185          301           74           74          115          156           83
ASV6           392            0            0            0            0           90          106          184
ASV7           163           34           86           82           84           83          153           48
ASV8           209          132          210          222          139          201          156          114
      16S-OEC-07-2 16S-OEC-08-1 16S-OEC-08-2 16S-OEC-09-1 16S-OEC-09-2 16S-OEC-10-1 16S-OEC-10-2 16S-OPS-01-1
ASV1          1042          605          503          275          990          710          475          294
ASV2           127          163           94           57          236          134           74          128
ASV3           224          377          379          126          226          185          190          197
ASV4           157           95          114           27          480          164           68          531
ASV5           221          101           41           24          175          200           92          578
ASV6           138            0            0            0          167          140            0          331
ASV7            62           55           43           47           51           66            0           63
ASV8           340           56            0          121          227          319          257          187
      16S-OPS-01-2 16S-OPS-02-1 16S-OPS-02-2 16S-OPS-03-1 16S-OPS-03-2 16S-OPS-04-1 16S-OPS-04-2 16S-OPS-05-1
ASV1           169          269          289          187          165            0          241            0
ASV2            56           63           89           61           63           52           36            0
ASV3            81          199          123           85          111            0          109          213
ASV4           311           28          169          192          106           61           13            0
ASV5           391          160          158          153          177            0           66           60
ASV6           151            0          136          144          168            0            0            0
ASV7             0           36            0            0            0            0           26          130
ASV8             0          180          106           58          155            0          123           19
      16S-OPS-05-2 16S-OPS-06-1 16S-OPS-06-2 16S-OPS-07-1 16S-OPS-07-2 16S-OPS-08-1 16S-OPS-08-2 16S-OPS-21-1
ASV1            59          136           93            0          321          377           50          346
ASV2             0          350          320          813           97          572          447          646
ASV3           277           66           62           34          296          119            0          222
ASV4            26          619          465          396            7          602          140          676
ASV5           153          503          428          269          187          218          255          297
ASV6            92          334          254          817            0          241          690          288
ASV7            81          172           99          178           31          156          140           93
ASV8            22           96           72           12          420          159            0          285
      16S-OPS-29-1 16S-OPS-29-2 16S-OSF-07-1 16S-OSF-07-2 16S-OSF-08-1 16S-OSF-08-2 16S-OSF-09-1 16S-OSF-09-2
ASV1           121           98         1563         1435          147          965            0            0
ASV2            24          507          192          205            0          238          129            0
ASV3             0          307          272          348          207          366            0            0
ASV4            99          143           74           94           82          120          130           33
ASV5            61          377          237          207          158          271           23            0
ASV6             0          289            0          114            0          746            0            0
ASV7             0          317           52          103          158          597            0            0
ASV8            86           69          253          198           28          283            0            0
      16S-OSF-10-1 16S-OSF-10-2 16S-OSF-11-1 16S-OSF-11-2 16S-OSF-17-1 16S-OSF-17-2 16S-OSF-18-1 16S-OSF-18-2
ASV1           644          367           89          111          797          880         1183          105
ASV2           278          314            0           23          248          171          426           58
ASV3           270          443          109          348          757          606          262          240
ASV4           414           17          143           27          103           84          136           53
ASV5           486          137          213          222          176          256          227          148
ASV6           275          790           52            0          141            0          518            0
ASV7           119          605           15           93          280          253          359           33
ASV8           222          178           41           59          468          295          528           63
      16S-OSF-19-1 16S-OSF-19-2 16S-OSF-21-1 16S-OSF-21-2 16S-OSF-22-1 16S-OSF-22-2
ASV1           869         1008          485          310          289          213
ASV2           390          306          854          192           85          270
ASV3           408          563          266          522          108          191
ASV4            91          179            0          113          129          377
ASV5           161          291           57          339           81          411
ASV6           683          425          542            0            0          271
ASV7           194          391          216          472           36          115
ASV8           389          345           32          400          249           17
 [ reached getOption("max.print") -- omitted 2 rows ]
> str(bacteria.ps.dataset.norm)
Formal class 'phyloseq' [package "phyloseq"] with 5 slots
  ..@ otu_table:Formal class 'otu_table' [package "phyloseq"] with 2 slots
  .. .. ..@ .Data        : num [1:3099, 1:118] 0 0 0 0 0 0 0 0 0 0 ...
  .. .. .. ..- attr(*, "dimnames")=List of 2
  .. .. .. .. ..$ : chr [1:3099] "ASV1" "ASV2" "ASV3" "ASV4" ...
  .. .. .. .. ..$ : chr [1:118] "16S-BLANCO1" "16S-BLANCO2" "16S-MEC-01-1" "16S-MEC-01-2" ...
  .. .. ..@ taxa_are_rows: logi TRUE
  .. .. ..$ dim     : int [1:2] 3099 118
  .. .. ..$ dimnames:List of 2
  .. .. .. ..$ : chr [1:3099] "ASV1" "ASV2" "ASV3" "ASV4" ...
  .. .. .. ..$ : chr [1:118] "16S-BLANCO1" "16S-BLANCO2" "16S-MEC-01-1" "16S-MEC-01-2" ...
  ..@ tax_table:Formal class 'taxonomyTable' [package "phyloseq"] with 1 slot
  .. .. ..@ .Data: chr [1:3099, 1:7] "Bacteria" "Bacteria" "Bacteria" "Bacteria" ...
  .. .. .. ..- attr(*, "dimnames")=List of 2
  .. .. .. .. ..$ : chr [1:3099] "ASV1" "ASV2" "ASV3" "ASV4" ...
  .. .. .. .. ..$ : chr [1:7] "Kingdom" "Phylum" "Class" "Order" ...
  .. .. ..$ dim     : int [1:2] 3099 7
  .. .. ..$ dimnames:List of 2
  .. .. .. ..$ : chr [1:3099] "ASV1" "ASV2" "ASV3" "ASV4" ...
  .. .. .. ..$ : chr [1:7] "Kingdom" "Phylum" "Class" "Order" ...
  ..@ sam_data :'data.frame':	118 obs. of  30 variables:
Formal class 'sample_data' [package "phyloseq"] with 4 slots
  .. .. ..@ .Data    :List of 30
  .. .. .. ..$ : Factor w/ 2 levels "NA","Zamiaceae": 1 1 2 2 2 2 2 2 2 2 ...
  .. .. .. ..$ : Factor w/ 2 levels "NA","Zamia pseudoparasitica": 1 1 2 2 2 2 2 2 2 2 ...
  .. .. .. ..$ : logi [1:118] FALSE FALSE FALSE FALSE FALSE FALSE ...
  .. .. .. ..$ : Factor w/ 3 levels "Dry","NA","Rainy": 2 2 1 1 1 1 1 1 1 1 ...
  .. .. .. ..$ : Factor w/ 8 levels "16-10-2022","19-03-2023",..: 8 8 7 7 7 7 7 7 7 7 ...
  .. .. .. ..$ : Factor w/ 2 levels "NA","Panamá": 1 1 2 2 2 2 2 2 2 2 ...
  .. .. .. ..$ : Factor w/ 4 levels "Bocas del Toro",..: 3 3 2 2 2 2 2 2 2 2 ...
  .. .. .. ..$ : Factor w/ 5 levels "Bosque Protector Palo Seco (Finca Sr. Desiderio",..: 3 3 4 4 4 4 4 4 4 4 ...
  .. .. .. ..$ : Factor w/ 20 levels "8.5291169999999994",..: 20 20 6 6 7 7 8 8 9 9 ...
  .. .. .. ..$ : Factor w/ 19 levels "-80.590299999999999",..: 19 19 3 3 5 5 4 4 6 6 ...
  .. .. .. ..$ : Factor w/ 20 levels "506","542","566",..: 20 20 10 10 12 12 9 9 11 11 ...
  .. .. .. ..$ : Factor w/ 7 levels "10","5","6","7",..: 7 7 2 2 5 5 2 2 2 2 ...
  .. .. .. ..$ : Factor w/ 9 levels "10","11","3",..: 9 9 5 5 1 1 5 5 8 8 ...
  .. .. .. ..$ : Factor w/ 3 levels "F","NA","NI": 2 2 3 3 3 3 1 1 3 3 ...
  .. .. .. ..$ : Factor w/ 3 levels "0","1","NA": 3 3 1 1 1 1 2 2 1 1 ...
  .. .. .. ..$ : Factor w/ 112 levels "10.052","10.121",..: 112 112 87 77 1 22 108 15 49 12 ...
  .. .. .. ..$ : Factor w/ 58 levels "28.94","44.53",..: 58 58 19 19 6 6 35 35 11 11 ...
  .. .. .. ..$ : Factor w/ 15 levels "100","59.9","77.099999999999994",..: 15 15 1 1 1 1 1 1 1 1 ...
  .. .. .. ..$ : Factor w/ 34 levels "19.5","19.600000000000001",..: 34 34 2 2 3 3 7 7 8 8 ...
  .. .. .. ..$ : Factor w/ 62 levels "17.3","17.5",..: 62 62 4 1 9 14 14 12 16 15 ...
  .. .. .. ..$ : Factor w/ 56 levels "0.1111111111111111",..: 56 56 26 26 27 27 28 28 31 31 ...
  .. .. .. ..$ : Factor w/ 59 levels "-0.4","-0.5",..: 10 25 52 24 28 32 50 24 19 28 ...
  .. .. .. ..$ : Factor w/ 1 level "DNeasy Power Soil (Quiagen)": 1 1 1 1 1 1 1 1 1 1 ...
  .. .. .. ..$ : Factor w/ 82 levels "-1.49","0.21",..: 8 44 57 41 44 36 25 48 41 36 ...
  .. .. .. ..$ : Factor w/ 70 levels "-0.12","-0.14000000000000001",..: 11 53 58 41 34 36 53 46 22 47 ...
  .. .. .. ..$ : Factor w/ 4 levels "A. Sierra","L. Rodriguez",..: 2 2 2 2 2 2 2 2 2 2 ...
  .. .. .. ..$ : Factor w/ 3 levels "30","50","60": 2 2 2 2 2 2 2 2 2 2 ...
  .. .. .. ..$ : Factor w/ 15 levels "13-05-2023","21-11-2022",..: 9 11 8 8 12 8 8 8 12 13 ...
  .. .. .. ..$ : num [1:118] 14.2 14.2 14.2 14.2 14.2 14.2 14.2 14.2 14.2 14.2 ...
  .. .. .. ..$ : Factor w/ 118 levels "16S-BLANCO1",..: 1 2 3 4 5 6 7 8 9 10 ...
  .. .. ..@ names    : chr [1:30] "Family" "Specie" "isneg" "Season" ...
  .. .. ..@ row.names: chr [1:118] "16S-BLANCO1" "16S-BLANCO2" "16S-MEC-01-1" "16S-MEC-01-2" ...
  .. .. ..@ .S3Class : chr "data.frame"
  ..@ phy_tree : NULL
  ..@ refseq   :Formal class 'DNAStringSet' [package "Biostrings"] with 5 slots
  .. .. ..@ pool           :Formal class 'SharedRaw_Pool' [package "XVector"] with 2 slots
  .. .. .. .. ..@ xp_list                    :List of 1
  .. .. .. .. .. ..$ :<externalptr> 
  .. .. .. .. ..@ .link_to_cached_object_list:List of 1
  .. .. .. .. .. ..$ :<environment: 0x2df31f580> 
  .. .. ..@ ranges         :Formal class 'GroupedIRanges' [package "XVector"] with 7 slots
  .. .. .. .. ..@ group          : int [1:3099] 1 1 1 1 1 1 1 1 1 1 ...
  .. .. .. .. ..@ start          : int [1:3099] 1 304 607 907 1206 1505 1805 2103 2403 2702 ...
  .. .. .. .. ..@ width          : int [1:3099] 303 303 300 299 299 300 298 300 299 298 ...
  .. .. .. .. ..@ NAMES          : chr [1:3099] "ASV1" "ASV2" "ASV3" "ASV4" ...
  .. .. .. .. ..@ elementType    : chr "ANY"
  .. .. .. .. ..@ elementMetadata: NULL
  .. .. .. .. ..@ metadata       : list()
  .. .. ..@ elementType    : chr "DNAString"
  .. .. ..@ elementMetadata: NULL
  .. .. ..@ metadata       : list()
> ###Save normalized Phyloseq object
> View(sample_data(bacteria.ps.dataset.norm))
> sample_sums(bacteria.ps.dataset.norm)
 16S-BLANCO1  16S-BLANCO2 16S-MEC-01-1 16S-MEC-01-2 16S-MEC-02-1 16S-MEC-02-2 16S-MEC-03-1 16S-MEC-03-2 
         501        14036        18524        19378        16767         9465         8572        17205 
16S-MEC-04-1 16S-MEC-04-2 16S-MEC-05-1 16S-MEC-05-2 16S-MEC-06-1 16S-MEC-07-1 16S-MEC-07-2 16S-MEC-08-1 
       20418        29339        14771        16518        12538        16073         9077        19155 
16S-MEC-08-2 16S-MEC-09-1 16S-MEC-09-2 16S-MEC-10-1 16S-MEC-10-2 16S-MPS-01-1 16S-MPS-01-2 16S-MPS-02-1 
       11110        23058        20097        19326        20887        15535        15848        22997 
16S-MPS-02-2 16S-MPS-03-1 16S-MPS-03-2 16S-MPS-04-1 16S-MPS-04-2 16S-MPS-05-1 16S-MPS-05-2 16S-MPS-06-1 
       25867        13269        12633        15632        15374        29747        22931        18416 
16S-MPS-06-2 16S-MPS-07-1 16S-MPS-07-2 16S-MPS-08-2 16S-MPS-21-1 16S-MPS-21-2 16S-MPS-29-1 16S-MPS-29-2 
       14934        15465        20606        36818        24419        18780        20700        30344 
16S-MSF-07-1 16S-MSF-07-2 16S-MSF-08-1 16S-MSF-08-2 16S-MSF-09-1 16S-MSF-09-2 16S-MSF-10-1 16S-MSF-10-2 
       13359        10651        16106        16606        18404        13309        25869        22871 
16S-MSF-11-1 16S-MSF-11-2 16S-MSF-17-1 16S-MSF-17-2 16S-MSF-18-1 16S-MSF-18-2 16S-MSF-19-2 16S-MSF-21-1 
       10746        15997        23336        22297        20998        16246        20957        12688 
16S-MSF-21-2 16S-MSF-22-1 16S-MSF-22-2 16S-OEC-01-1 16S-OEC-01-2 16S-OEC-02-1 16S-OEC-02-2 16S-OEC-03-1 
        5896        21178        15878        23721        15945        24677        21434        25606 
16S-OEC-03-2 16S-OEC-04-1 16S-OEC-04-2 16S-OEC-05-1 16S-OEC-05-2 16S-OEC-06-1 16S-OEC-06-2 16S-OEC-07-1 
       23762        19598        20155        20649        18846        20578        19312        14745 
16S-OEC-07-2 16S-OEC-08-1 16S-OEC-08-2 16S-OEC-09-1 16S-OEC-09-2 16S-OEC-10-1 16S-OEC-10-2 16S-OPS-01-1 
       23392        23903        18822        14077        23527        23900        17993        21822 
16S-OPS-01-2 16S-OPS-02-1 16S-OPS-02-2 16S-OPS-03-1 16S-OPS-03-2 16S-OPS-04-1 16S-OPS-04-2 16S-OPS-05-1 
       12823        15974        28760        14204        13563         2032        11472         8366 
16S-OPS-05-2 16S-OPS-06-1 16S-OPS-06-2 16S-OPS-07-1 16S-OPS-07-2 16S-OPS-08-1 16S-OPS-08-2 16S-OPS-21-1 
       16700        22788        18737        21926        28701        22847        18182        30702 
16S-OPS-29-1 16S-OPS-29-2 16S-OSF-07-1 16S-OSF-07-2 16S-OSF-08-1 16S-OSF-08-2 16S-OSF-09-1 16S-OSF-09-2 
        9899        28830        17148        22470        11676        20226         3295         3011 
16S-OSF-10-1 16S-OSF-10-2 16S-OSF-11-1 16S-OSF-11-2 16S-OSF-17-1 16S-OSF-17-2 16S-OSF-18-1 16S-OSF-18-2 
       21198        15501        11584        14632        19610        15726        20372        11771 
16S-OSF-19-1 16S-OSF-19-2 16S-OSF-21-1 16S-OSF-21-2 16S-OSF-22-1 16S-OSF-22-2 
       17245        24340        10265        12972        15774        12625 
> ## Run DESeq2 function:
> ##bacteria.ps.dataset.norm.desq = DESeq(bacteria.ps.dataset.norm.deseq, test = "Wald", fitType = "mean") #no corrio
> DESeq(bacteria.ps.dataset.norm.deseq)
using pre-existing size factors
estimating dispersions
found already estimated dispersions, replacing these
gene-wise dispersion estimates
mean-dispersion relationship
  Note: levels of factors in the design contain characters other than
  letters, numbers, '_' and '.'. It is recommended (but not required) to use
  only letters, numbers, and delimiters '_' or '.', as these are safe characters
  for column names in R. [This is a message, not a warning or an error]
final dispersion estimates
fitting model and testing
  Note: levels of factors in the design contain characters other than
  letters, numbers, '_' and '.'. It is recommended (but not required) to use
  only letters, numbers, and delimiters '_' or '.', as these are safe characters
  for column names in R. [This is a message, not a warning or an error]
-- replacing outliers and refitting for 4563 genes
-- DESeq argument 'minReplicatesForReplace' = 7 
-- original counts are preserved in counts(dds)
estimating dispersions
fitting model and testing
  Note: levels of factors in the design contain characters other than
  letters, numbers, '_' and '.'. It is recommended (but not required) to use
  only letters, numbers, and delimiters '_' or '.', as these are safe characters
  for column names in R. [This is a message, not a warning or an error]
class: DESeqDataSet 
dim: 15048 118 
metadata(1): version
assays(6): counts mu ... replaceCounts replaceCooks
rownames(15048): ASV1 ASV2 ... ASV16184 ASV16189
rowData names(35): baseMean baseVar ... maxCooks replace
colnames(118): 16S-BLANCO1 16S-BLANCO2 ... 16S-OSF-22-1 16S-OSF-22-2
colData names(32): Family Specie ... sizeFactor replaceable
> ## Investiga test results table
> res = results(bacteria.ps.dataset.norm.deseq)
> res = res[order(res$padj, na.last = NA), ]
> hist(res$padj)
> alpha = 0.05
> sigtab = res[(res$padj < alpha), ]
> sigtab = cbind(as(sigtab, "data.frame"), as(tax_table(bacteria.ps.dataset)[rownames(sigtab), ], "matrix"))
Error in (function (cond)  : 
  error in evaluating the argument 'object' in selecting a method for function 'tax_table': subscript out of bounds
> str(sigtab)
Formal class 'DESeqResults' [package "DESeq2"] with 7 slots
  ..@ priorInfo      : list()
  ..@ rownames       : chr [1:22] "ASV64" "ASV417" "ASV666" "ASV191" ...
  ..@ nrows          : int 22
  ..@ elementType    : chr "ANY"
  ..@ elementMetadata:Formal class 'DFrame' [package "S4Vectors"] with 6 slots
  .. .. ..@ rownames       : NULL
  .. .. ..@ nrows          : int 6
  .. .. ..@ elementType    : chr "ANY"
  .. .. ..@ elementMetadata: NULL
  .. .. ..@ metadata       : list()
  .. .. ..@ listData       :List of 2
  .. .. .. ..$ type       : chr [1:6] "intermediate" "results" "results" "results" ...
  .. .. .. ..$ description: chr [1:6] "mean of normalized counts for all samples" "log2 fold change (MLE): Site Parque.Nacional.Santa.Fe vs Bosque.Protector.Palo.Seco..Finca.Sr..Desiderio" "standard error: Site Parque.Nacional.Santa.Fe vs Bosque.Protector.Palo.Seco..Finca.Sr..Desiderio" "Wald statistic: Site Parque.Nacional.Santa.Fe vs Bosque.Protector.Palo.Seco..Finca.Sr..Desiderio" ...
  ..@ metadata       :List of 6
  .. ..$ filterThreshold: Named num 0.00551
  .. .. ..- attr(*, "names")= chr "20.85327%"
  .. ..$ filterTheta    : num 0.209
  .. ..$ filterNumRej   :'data.frame':	50 obs. of  2 variables:
  .. .. ..$ theta : num [1:50] 0.209 0.224 0.239 0.254 0.269 ...
  .. .. ..$ numRej: num [1:50] 22 22 22 22 22 22 22 22 22 22 ...
  .. ..$ lo.fit         :List of 2
  .. .. ..$ x: num [1:50] 0.209 0.224 0.239 0.254 0.269 ...
  .. .. ..$ y: num [1:50] 22 22 22 22 22 ...
  .. ..$ alpha          : num 0.1
  .. ..$ lfcThreshold   : num 0
  ..@ listData       :List of 6
  .. ..$ baseMean      : num [1:22] 27.53 7.94 5.18 5.69 10.1 ...
  .. ..$ log2FoldChange: num [1:22] -30 -29.8 -29.9 -29.8 -26.4 ...
  .. ..$ lfcSE         : num [1:22] 3.48 3.48 3.58 4.48 4.39 ...
  .. ..$ stat          : num [1:22] -8.62 -8.55 -8.35 -6.66 -6.01 ...
  .. ..$ pvalue        : num [1:22] 6.62e-18 1.21e-17 6.68e-17 2.79e-11 1.82e-09 ...
  .. ..$ padj          : num [1:22] 7.19e-14 7.19e-14 2.65e-13 8.32e-08 4.34e-06 ..

> #rarefied samples to even sequencing depth
> bacteria.ps.dataset
phyloseq-class experiment-level object
otu_table()   OTU Table:         [ 3099 taxa and 118 samples ]
sample_data() Sample Data:       [ 118 samples by 30 sample variables ]
tax_table()   Taxonomy Table:    [ 3099 taxa by 7 taxonomic ranks ]
refseq()      DNAStringSet:      [ 3099 reference sequences ]
> richness.df = estimate_richness(bacteria.ps.dataset.norm, split = TRUE, measures = c("Observed","Shannon","Simpson","Chao1"))
> richness.df$readcount = sample_sums(bacteria.ps.dataset.norm)
> str(richness.df)
'data.frame':	118 obs. of  6 variables:
 $ Observed : num  11 291 373 470 294 182 213 374 184 665 ...
 $ Chao1    : num  11 291 373 470 294 182 213 374 184 665 ...
 $ se.chao1 : num  0 0 0 0 0 ...
 $ Shannon  : num  1.5 5.36 5.55 5.77 5.26 ...
 $ Simpson  : num  0.598 0.994 0.994 0.995 0.991 ...
 $ readcount: num  501 14036 18524 19378 16767 ...
 library("ggpubr")

Attaching package: ‘ggpubr’

The following object is masked from ‘package:ggtree’:

    rotate

The following object is masked from ‘package:ape’:

    rotate

> ggscatter(richness.df, x= "readcount", y = "Observed",
+           add = "reg.line", conf.int = TRUE,
+           cor.coef = TRUE, cor.method = "kendall",
+           xlab = "Read count", ylab = "Observed species")
> shapiro.test(richness.df$readcount) # => p= <0.001 

	Shapiro-Wilk normality test

data:  richness.df$readcount
W = 0.98861, p-value = 0.431
> #Shapiro-Wilk normality test for wt
> shapiro.test(richness.df$Observed) # => p= <0.001 

	Shapiro-Wilk normality test

data:  richness.df$Observed
W = 0.96415, p-value = 0.00307
> random_tree = rtree(ntaxa(bacteria.ps.dataset.norm), rooted = TRUE, tip.label = taxa_names(bacteria.ps.dataset.norm))
Found more than one class "phylo" in cache; using the first, from namespace 'phyloseq'
Also defined by ‘tidytree’
> seqs <- refseq(bacteria.ps.dataset)
> alignment <- AlignSeqs(DNAStringSet(seqs), anchor=NA)
Determining distance matrix based on shared 8-mers:
  |====================================================================================================| 100%

Time difference of 49.44 secs

Clustering into groups by similarity:
  |====================================================================================================| 100%

Time difference of 0.46 secs

Aligning Sequences:
  |====================================================================================================| 100%

Time difference of 8.06 secs

Iteration 1 of 2:

Determining distance matrix based on alignment:
  |====================================================================================================| 100%

Time difference of 3.31 secs

Reclustering into groups by similarity:
  |====================================================================================================| 100%

Time difference of 0.54 secs

Realigning Sequences:
  |====================================================================================================| 100%

Time difference of 5.24 secs

Iteration 2 of 2:

Determining distance matrix based on alignment:
  |====================================================================================================| 100%

Time difference of 3.35 secs

Reclustering into groups by similarity:
  |====================================================================================================| 100%

Time difference of 0.51 secs

Realigning Sequences:
  |====================================================================================================| 100%

Time difference of 1.28 secs

> phang.align <- phyDat(as(alignment, "matrix"), type = "DNA")
> dm <- dist.ml(phang.align)
> treeNJ <- NJ(dm) #Note, tip order != sequence order
Found more than one class "phylo" in cache; using the first, from namespace 'phyloseq'
Also defined by ‘tidytree’
> fit = pml(treeNJ, data=phang.align)
> ## negative edges length changed to 0!
> fitGTR <- update(fit, k=4, inv=0.2)
> fitGTR <- optim.pml(fitGTR, model = "GTR", optInv = TRUE, optGamma = TRUE,
+                     rearrangement = "stochastic",
+                     control = pml.control(trace = 0))
> fitGTR$tree

Phylogenetic tree with 3099 tips and 3097 internal nodes.

Tip labels:
  ASV1, ASV2, ASV3, ASV4, ASV5, ASV6, ...
Node labels:
  1, NA, 0.004, 0.004, 0.921, 0.866, ...

Unrooted; includes branch lengths.

> #This might take time to plot tree
> plot(random_tree)
Found more than one class "phylo" in cache; using the first, from namespace 'phyloseq'
Also defined by ‘tidytree’
Found more than one class "phylo" in cache; using the first, from namespace 'phyloseq'
Also defined by ‘tidytree’
